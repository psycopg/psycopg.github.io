<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Transaction management" href="transactions.html" /><link rel="prev" title="Passing parameters to SQL queries" href="params.html" />

    <meta name="generator" content="sphinx-3.3.1, furo 2021.03.20.beta30"/>
        <title>Adaptation between Python and PostgreSQL types - psycopg3 UNRELEASED documentation</title>
      <link rel="stylesheet" href="../_static/styles/furo.css?digest=978e1795dfe158b585dda6a8417f6411828bf3ed">
    <link rel="stylesheet" href="../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 1rem;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 1rem;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../_static/psycopg.css" />
    <link rel="stylesheet" href="../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<div class="announcement">
  <aside class="announcement-content">
     <a style="text-decoration: none; color: white;"
   href="https://github.com/sponsors/dvarrazzo/">
   <img height="24px" width="24px" src="/img/logo/psycopg-48.png"/>
    Sponsor psycopg3 on GitHub
</a>
 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">psycopg3 UNRELEASED documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/psycopg.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/psycopg.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">psycopg3 UNRELEASED documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Getting started with <code class="docutils literal notranslate"><span class="pre">psycopg3</span></code></a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html">Basic module usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="params.html">Passing parameters to SQL queries</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Adaptation between Python and PostgreSQL types</a></li>
<li class="toctree-l2"><a class="reference internal" href="transactions.html">Transaction management</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced/index.html">Advanced topics</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../advanced/async.html">Async operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/copy.html">Using COPY TO and COPY FROM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/cursors.html">Cursor types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/rows.html">Row factories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/pool.html">Connection pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/adapt.html">Data adaptation configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/prepare.html">Prepared statements</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html"><code class="docutils literal notranslate"><span class="pre">psycopg3</span></code> API</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/connections.html">Connection classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/cursors.html">Cursor classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sql.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sql</span></code> – SQL string composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/errors.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">errors</span></code> – package exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/pool.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pool</span></code> – Connection pool implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/types.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">types</span></code> – types mapping and adaptation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/pq.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pq</span></code> – libpq wrapper module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../from_pg2.html">Differences from <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code></a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="adaptation-between-python-and-postgresql-types">
<span id="types-adaptation"></span><span id="index-0"></span><h1>Adaptation between Python and PostgreSQL types<a class="headerlink" href="#adaptation-between-python-and-postgresql-types" title="Permalink to this headline">¶</a></h1>
<p>Many standard Python types are adapted into SQL and returned as Python
objects when a query is executed.</p>
<p>The following table shows the default mapping between Python and PostgreSQL
types:</p>
<p>TODO: complete table</p>
<div class="table-wrapper"><table class="data-types docutils align-default">
<colgroup>
<col style="width: 28%"/>
<col style="width: 35%"/>
<col style="width: 37%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Python</p></th>
<th class="head"><p>PostgreSQL</p></th>
<th class="head"><p>See also</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><a class="reference internal" href="#adapt-bool"><span class="std std-ref">Booleans adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">real</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">double</span></code></div>
</div>
</td>
<td rowspan="3"><p><a class="reference internal" href="#adapt-numbers"><span class="std std-ref">Numbers adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></div>
<div class="line"><br/></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">smallint</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">integer</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">bigint</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Decimal" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decimal</span></code></a></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">numeric</span></code></p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></div>
<div class="line"><br/></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">varchar</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">text</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="#adapt-string"><span class="std std-ref">Strings adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code></a></div>
<div class="line"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytearray</span></code></a></div>
<div class="line"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#memoryview" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">memoryview</span></code></a></div>
</div>
</td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">bytea</span></code></p></td>
<td><p><a class="reference internal" href="#adapt-binary"><span class="std std-ref">Binary adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">date</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">date</span></code></p></td>
<td rowspan="4"><p><a class="reference internal" href="#adapt-date"><span class="std std-ref">TODO adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">time</span></code></p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">time</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">timetz</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime</span></code></p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">timestamp</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">timestamptz</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">timedelta</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">interval</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">ARRAY</span></code></p></td>
<td><p><a class="reference internal" href="#adapt-list"><span class="std std-ref">TODO adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code></div>
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">namedtuple</span></code></div>
</div>
</td>
<td><p>Composite types</p></td>
<td><p><a class="reference internal" href="#adapt-composite"><span class="std std-ref">TODO adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">hstore</span></code></p></td>
<td><p><a class="reference internal" href="#adapt-hstore"><span class="std std-ref">TODO adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>Psycopg’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">Range</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">range</span></code></p></td>
<td><p><a class="reference internal" href="#adapt-range"><span class="std std-ref">TODO adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><p>Anything™</p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">json</span></code></p></td>
<td><p><a class="reference internal" href="#adapt-json"><span class="std std-ref">JSON adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://docs.python.org/3/library/uuid.html#uuid.UUID" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">UUID</span></code></a></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">uuid</span></code></p></td>
<td><p><a class="reference internal" href="#adapt-uuid"><span class="std std-ref">TODO adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://docs.python.org/3/library/ipaddress.html#module-ipaddress" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ipaddress</span></code></a>
objects</p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">inet</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">cidr</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="#adapt-network"><span class="std std-ref">TODO adaptation</span></a></p></td>
</tr>
</tbody>
</table></div>
<div class="section" id="booleans-adaptation">
<span id="adapt-bool"></span><span id="index-1"></span><h2>Booleans adaptation<a class="headerlink" href="#booleans-adaptation" title="Permalink to this headline">¶</a></h2>
<p>Python <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a> values <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code> are converted to the equivalent
<a class="reference external" href="https://www.postgresql.org/docs/current/datatype-boolean.html">PostgreSQL boolean type</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="go"># equivalent to "SELECT true, false"</span>
</pre></div>
</div>
</div>
<div class="section" id="numbers-adaptation">
<span id="adapt-numbers"></span><span id="index-2"></span><h2>Numbers adaptation<a class="headerlink" href="#numbers-adaptation" title="Permalink to this headline">¶</a></h2>
<p>Python <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> values are converted to PostgreSQL <code class="sql docutils literal notranslate"><span class="pre">bigint</span></code> (a.k.a.
<code class="sql docutils literal notranslate"><span class="pre">int8</span></code>). Note that this could create some problems:</p>
<ul>
<li><p>Python <code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code> is unbounded. If you are inserting numbers larger than 2^63
(so your target table is <code class="xref py py-obj docutils literal notranslate"><span class="pre">numeric</span></code>, or you’ll get an overflow on
arrival…) you should convert them to <a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Decimal" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decimal</span></code></a>.</p></li>
<li><p>Certain PostgreSQL functions and operators, such a <code class="sql docutils literal notranslate"><span class="pre">date</span> <span class="pre">+</span> <span class="pre">int</span></code>
expect an <code class="sql docutils literal notranslate"><span class="pre">integer</span></code> (aka <code class="sql docutils literal notranslate"><span class="pre">int4</span></code>): passing them a <code class="sql docutils literal notranslate"><span class="pre">bigint</span></code>
may cause an error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"select current_date + </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># UndefinedFunction: operator does not exist: date + bigint</span>
</pre></div>
</div>
<p>In this case you should add an <code class="sql docutils literal notranslate"><span class="pre">::int</span></code> cast to your query or use the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">Int4</span></code> wrapper:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"select current_date + </span><span class="si">%s</span><span class="s2">::int"</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"select current_date + </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="p">[</span><span class="n">Int4</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span>
</pre></div>
</div>
<div class="admonition-todo admonition">
<p class="admonition-title">TODO</p>
<p>document Int* wrappers</p>
</div>
</li>
</ul>
<p>Python <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> values are converted to PostgreSQL <code class="sql docutils literal notranslate"><span class="pre">float8</span></code>.</p>
<p>Python <a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Decimal" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decimal</span></code></a> values are converted to PostgreSQL <code class="sql docutils literal notranslate"><span class="pre">numeric</span></code>.</p>
<p>On the way back, smaller types (<code class="sql docutils literal notranslate"><span class="pre">int2</span></code>, <code class="sql docutils literal notranslate"><span class="pre">int4</span></code>, <code class="sql docutils literal notranslate"><span class="pre">flaot4</span></code>) are
promoted to the larger Python counterpart.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sometimes you may prefer to receive <code class="sql docutils literal notranslate"><span class="pre">numeric</span></code> data as <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>
instead, for performance reason or ease of manipulation: you can configure
an adapter to <a class="reference external" href="https://www.psycopg.org/docs/faq.html#faq-float" title="(in Psycopg v2.8)"><span class="xref std std-ref">cast PostgreSQL numeric to Python float</span></a>.
This of course may imply a loss of precision.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.postgresql.org/docs/current/static/datatype-numeric.html">PostgreSQL numeric types</a></p></li>
<li><p><a class="reference external" href="https://www.varrazzo.com/blog/2020/11/07/psycopg3-adaptation/">Musings about numeric adaptation choices</a></p></li>
</ul>
</div>
</div>
<div class="section" id="strings-adaptation">
<span id="adapt-string"></span><span id="index-3"></span><h2>Strings adaptation<a class="headerlink" href="#strings-adaptation" title="Permalink to this headline">¶</a></h2>
<p>Python <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> is converted to PostgreSQL string syntax, and PostgreSQL types
such as <code class="sql docutils literal notranslate"><span class="pre">text</span></code> and <code class="sql docutils literal notranslate"><span class="pre">varchar</span></code> are converted back to Python <code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg3</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="s2">"insert into strtest (id, data) values (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)"</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"Crème Brûlée at 4.99€"</span><span class="p">))</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"select data from strtest where id = 1"</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="s1">'Crème Brûlée at 4.99€'</span>
</pre></div>
</div>
<p>PostgreSQL databases <a class="reference external" href="https://www.postgresql.org/docs/current/sql-createdatabase.html">have an encoding</a>, and <a class="reference external" href="https://www.postgresql.org/docs/current/multibyte.html">the session has an encoding</a>
too, exposed in the <a class="reference internal" href="../api/connections.html#psycopg3.Connection.client_encoding" title="psycopg3.Connection.client_encoding"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection.client_encoding</span></code></a> attribute. If your database
and connection are in UTF-8 encoding you will likely have no problem,
otherwise you will have to make sure that your application only deals with the
non-ASCII chars that the database can handle; failing to do so may result in
encoding/decoding errors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The encoding is set at connection time according to the db configuration</span>
<span class="n">conn</span><span class="o">.</span><span class="n">client_encoding</span>
<span class="s1">'utf-8'</span>

<span class="c1"># The Latin-9 encoding can manage some European accented letters</span>
<span class="c1"># and the Euro symbol</span>
<span class="n">conn</span><span class="o">.</span><span class="n">client_encoding</span> <span class="o">=</span> <span class="s1">'latin9'</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"select data from strtest where id = 1"</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="s1">'Crème Brûlée at 4.99€'</span>

<span class="c1"># The Latin-1 encoding doesn't have a representation for the Euro symbol</span>
<span class="n">conn</span><span class="o">.</span><span class="n">client_encoding</span> <span class="o">=</span> <span class="s1">'latin1'</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"select data from strtest where id = 1"</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Traceback (most recent call last)</span>
<span class="c1"># ...</span>
<span class="c1"># UntranslatableCharacter: character with byte sequence 0xe2 0x82 0xac</span>
<span class="c1"># in encoding "UTF8" has no equivalent in encoding "LATIN1"</span>
</pre></div>
</div>
<p>In rare cases you may have strings with unexpected encodings in the database.
Using the <code class="docutils literal notranslate"><span class="pre">SQL_ASCII</span></code> client encoding (or setting
<a class="reference internal" href="../api/connections.html#psycopg3.Connection.client_encoding" title="psycopg3.Connection.client_encoding"><code class="xref py py-obj docutils literal notranslate"><span class="pre">client_encoding</span></code></a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">"ascii"</span></code>) will disable decoding of the data
coming from the database, which will be returned as <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">client_encoding</span> <span class="o">=</span> <span class="s2">"ascii"</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"select data from strtest where id = 1"</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="sa">b</span><span class="s1">'Cr</span><span class="se">\xc3\xa8</span><span class="s1">me Br</span><span class="se">\xc3\xbb</span><span class="s1">l</span><span class="se">\xc3\xa9</span><span class="s1">e at 4.99</span><span class="se">\xe2\x82\xac</span><span class="s1">'</span>
</pre></div>
</div>
<p>Alternatively you can cast the unknown encoding data to <code class="sql docutils literal notranslate"><span class="pre">bytea</span></code> to
retrieve it as bytes, leaving other strings unaltered: see <a class="reference internal" href="#adapt-binary"><span class="std std-ref">Binary adaptation</span></a></p>
<p>Note that PostgreSQL text cannot contain the <code class="docutils literal notranslate"><span class="pre">0x00</span></code> byte. If you need to
store Python strings that may contain binary zeros you should use a
<code class="sql docutils literal notranslate"><span class="pre">bytea</span></code> field.</p>
</div>
<div class="section" id="binary-adaptation">
<span id="adapt-binary"></span><span id="index-4"></span><h2>Binary adaptation<a class="headerlink" href="#binary-adaptation" title="Permalink to this headline">¶</a></h2>
<p>Python types representing binary objects (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytearray</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#memoryview" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">memoryview</span></code></a>)
are converted by default to <code class="sql docutils literal notranslate"><span class="pre">bytea</span></code> fields. By default data received is
returned as <code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code>.</p>
<div class="admonition-todo admonition">
<p class="admonition-title">todo</p>
<p>Make sure bytearry/memoryview work and are compsable with
arrays/composite</p>
</div>
<p>If you are storing large binary data in bytea fields (such as binary documents
or images) you should probably use the binary format to pass and return
values, otherwise binary data will undergo <a class="reference external" href="https://www.postgresql.org/docs/current/datatype-binary.html">ASCII escaping</a>, taking some CPU
time and more bandwidth. See <a class="reference internal" href="params.html#binary-data"><span class="std std-ref">Binary parameters and results</span></a> for details.</p>
</div>
<div class="section" id="json-adaptation">
<span id="adapt-json"></span><h2>JSON adaptation<a class="headerlink" href="#json-adaptation" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> can map between Python objects and PostgreSQL <a class="reference external" href="https://www.postgresql.org/docs/current/datatype-json.html">json/jsonb
types</a>, allowing to customise the load and dump function used.</p>
<p>Because several Python objects could be considered JSON (dicts, lists,
scalars, even date/time if using a dumps function customised to use them),
<code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> requires you to wrap what you want to dump as JSON into a wrapper:
either <a class="reference internal" href="../api/types.html#psycopg3.types.Json" title="psycopg3.types.Json"><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3.types.Json</span></code></a> or <a class="reference internal" href="../api/types.html#psycopg3.types.Jsonb" title="psycopg3.types.Jsonb"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Jsonb</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">psycopg3.types</span> <span class="kn">import</span> <span class="n">Jsonb</span>

<span class="n">thing</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"foo"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"bar"</span><span class="p">,</span> <span class="mi">42</span><span class="p">]}</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"insert into mytable values (</span><span class="si">%s</span><span class="s2">)"</span><span class="p">,</span> <span class="p">[</span><span class="n">Jsonb</span><span class="p">(</span><span class="n">thing</span><span class="p">)])</span>
</pre></div>
</div>
<p>By default <code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> uses the standard library <a class="reference external" href="https://docs.python.org/3/library/json.html#json.dumps">json.dumps()</a> and
<a class="reference external" href="https://docs.python.org/3/library/json.html#json.loads">json.loads()</a> functions to serialize and de-serialize Python objects to
JSON. If you want to customise globally how serialization happens, for
instance changing serialization parameters or using a different JSON library,
you can specify your own functions using the <a class="reference internal" href="../api/types.html#psycopg3.types.set_json_dumps" title="psycopg3.types.set_json_dumps"><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3.types.set_json_dumps()</span></code></a>
and <a class="reference internal" href="../api/types.html#psycopg3.types.set_json_loads" title="psycopg3.types.set_json_loads"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_json_loads()</span></code></a> functions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">psycopg3.types</span> <span class="kn">import</span> <span class="n">Jsonb</span><span class="p">,</span> <span class="n">set_json_dumps</span><span class="p">,</span> <span class="n">set_json_loads</span>
<span class="kn">import</span> <span class="nn">ujson</span>

<span class="c1"># Use a faster dump function</span>
<span class="n">set_json_dumps</span><span class="p">(</span><span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">)</span>

<span class="c1"># Return floating point values as Decimal</span>
<span class="n">set_json_loads</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">parse_float</span><span class="o">=</span><span class="n">Decimal</span><span class="p">))</span>

<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"select </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="p">[</span><span class="n">Jsonb</span><span class="p">({</span><span class="s2">"value"</span><span class="p">:</span> <span class="mf">123.45</span><span class="p">})])</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># {'value': Decimal('123.45')}</span>
</pre></div>
</div>
<p>If you need a more precise customisation, such as per-connection instead of
global, you can subclass and register the JSON adapters in the right context:
see <a class="reference internal" href="../api/types.html#json-adapters"><span class="std std-ref">JSON adapters</span></a>.</p>
</div>
<div class="section" id="todo-adaptation">
<span id="adapt-network"></span><span id="adapt-uuid"></span><span id="adapt-range"></span><span id="adapt-hstore"></span><span id="adapt-composite"></span><span id="adapt-list"></span><span id="adapt-date"></span><h2>TODO adaptation<a class="headerlink" href="#todo-adaptation" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition">
<p class="admonition-title">TODO</p>
<p>Document the other types</p>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="transactions.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Transaction management</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="params.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Passing parameters to SQL queries</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2020-2021, Daniele Varrazzo and The Psycopg Team
            |
            <a class="muted-link" href="../_sources/basic/adapt.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Adaptation between Python and PostgreSQL types</a><ul>
<li><a class="reference internal" href="#booleans-adaptation">Booleans adaptation</a></li>
<li><a class="reference internal" href="#numbers-adaptation">Numbers adaptation</a></li>
<li><a class="reference internal" href="#strings-adaptation">Strings adaptation</a></li>
<li><a class="reference internal" href="#binary-adaptation">Binary adaptation</a></li>
<li><a class="reference internal" href="#json-adaptation">JSON adaptation</a></li>
<li><a class="reference internal" href="#todo-adaptation">TODO adaptation</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>