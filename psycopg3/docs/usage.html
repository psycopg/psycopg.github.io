
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Basic module usage &#8212; psycopg3 UNRELEASED documentation</title>
    <style type="text/css" media="screen">
div.sponsor {
  background-color: #ffc;
  border: 2px solid #888;
  border-radius: 8px;
  padding: 1em;
  padding-bottom: 0.25em;
  margin-top: 1em;
}
div.sponsor p {
  margin: 0.5rem 0;
}
    </style>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/better.css" type="text/css" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19287248-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-19287248-2');
    </script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Connection classes" href="connection.html" />
    <link rel="prev" title="Installation" href="install.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <link rel="stylesheet" href="_static/psycopg.css" type="text/css" />
  </head><body>
    <header id="pageheader"><h1><a href="index.html ">
        psycopg3 UNRELEASED documentation
    </a></h1></header>
  <div class="related top">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="install.html" title="Previous document">Installation</a>
        </li>
        <li>
          <a href="connection.html" title="Next document">Connection classes</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="index.html">psycopg3 UNRELEASED documentation</a></li> 
    </ul>
  </nav>
  </div>  

    <div class="document">
    <div class="sponsor">
      <p>
      The <a href="https://psycopg.org/psycopg3" target="_blank"
        >psycopg3 project</a>
      is currently
      <a href="https://github.com/psycopg/psycopg3" target="_blank"
        >under active development</a>.
      </p>

      <p>
      Sponsoring this project will help achieve swift completion and
      ensure the maintenance of psycopg2, psycopg3 and other related
      projects.
      </p>

      <p>
      If you use Python and PostgreSQL, and you would like to support the
      creation of the most advanced adapter between the two systems,
      <a href="https://github.com/sponsors/dvarrazzo/" target="_blank"
        >please consider becoming a sponsor</a>. Thank you!
      </p>

      <iframe src="https://github.com/sponsors/dvarrazzo/button"
              title="Sponsor the project" style="border: 0"
              width="116" height="35">
      </iframe>
    </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="basic-module-usage">
<span id="usage"></span><span id="index-0"></span><h1>Basic module usage<a class="headerlink" href="#basic-module-usage" title="Permalink to this headline">¶</a></h1>
<p>The basic Psycopg usage is common to all the database adapters implementing
the <a class="reference external" href="https://www.python.org/dev/peps/pep-0249/">DB API</a> protocol. Here is an interactive session showing some of the
basic commands:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg3</span>

<span class="c1"># Connect to an existing database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;dbname=test user=postgres&quot;</span><span class="p">)</span>

<span class="c1"># Open a cursor to perform database operations</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Execute a command: this creates a new table</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    CREATE TABLE test (</span>
<span class="s2">        id serial PRIMARY KEY,</span>
<span class="s2">        num integer,</span>
<span class="s2">        data text)</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Pass data to fill a query placeholders and let Psycopg perform</span>
<span class="c1"># the correct conversion (no SQL injections!)</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="s2">&quot;INSERT INTO test (num, data) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;abc&#39;def&quot;</span><span class="p">))</span>

<span class="c1"># Query the database and obtain data as Python objects.</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM test&quot;</span><span class="p">)</span>
<span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="c1"># will return (1, 100, &quot;abc&#39;def&quot;)</span>

<span class="c1"># You can use `cur.fetchmany()`, `cur.fetchall()` to return a list</span>
<span class="c1"># of several records, or even iterate on the cursor</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

<span class="c1"># Make the changes to the database persistent</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># Close communication with the database</span>
<span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that the <code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor.execute()</span></code> method returns the cursor itself, so the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">fetch*()</span></code> methods can be appended right after it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM test&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</pre></div>
</div>
<p>The main entry points of <code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> are:</p>
<ul class="simple">
<li><p>The function <code class="xref py py-obj docutils literal notranslate"><span class="pre">connect()</span></code> creates a new database session and
returns a new <a class="reference external" href="https://www.psycopg.org/docs/connection.html#connection" title="(in Psycopg v2.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection</span></code></a> instance. <a class="reference internal" href="connection.html#psycopg3.AsyncConnection.connect" title="psycopg3.AsyncConnection.connect"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnection.connect()</span></code></a>
creates an <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">asyncio</span></code></a> connection instead.</p></li>
<li><p>The <a class="reference internal" href="connection.html#psycopg3.Connection" title="psycopg3.Connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection</span></code></a> class encapsulates a database session. It allows to:</p>
<ul>
<li><p>create new <a class="reference internal" href="cursor.html#psycopg3.Cursor" title="psycopg3.Cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Cursor</span></code></a> instances using the <a class="reference internal" href="connection.html#psycopg3.Connection.cursor" title="psycopg3.Connection.cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor()</span></code></a> method to
execute database commands and queries,</p></li>
<li><p>terminate transactions using the methods <a class="reference internal" href="connection.html#psycopg3.Connection.commit" title="psycopg3.Connection.commit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">commit()</span></code></a> or
<a class="reference internal" href="connection.html#psycopg3.Connection.rollback" title="psycopg3.Connection.rollback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rollback()</span></code></a>.</p></li>
</ul>
</li>
<li><p>The class <a class="reference internal" href="cursor.html#psycopg3.Cursor" title="psycopg3.Cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Cursor</span></code></a> allows interaction with the database:</p>
<ul>
<li><p>send commands to the database using methods such as <a class="reference internal" href="cursor.html#psycopg3.Cursor.execute" title="psycopg3.Cursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">execute()</span></code></a>
and <a class="reference internal" href="cursor.html#psycopg3.Cursor.executemany" title="psycopg3.Cursor.executemany"><code class="xref py py-obj docutils literal notranslate"><span class="pre">executemany()</span></code></a>,</p></li>
<li><p>retrieve data from the database, iterating on the cursor or using methods
such as <a class="reference internal" href="cursor.html#psycopg3.Cursor.fetchone" title="psycopg3.Cursor.fetchone"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fetchone()</span></code></a>, <a class="reference internal" href="cursor.html#psycopg3.Cursor.fetchmany" title="psycopg3.Cursor.fetchmany"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fetchmany()</span></code></a>, <a class="reference internal" href="cursor.html#psycopg3.Cursor.fetchall" title="psycopg3.Cursor.fetchall"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fetchall()</span></code></a>.</p></li>
</ul>
</li>
</ul>
<div class="section" id="with-connections-and-cursors">
<span id="with-statement"></span><span id="index-1"></span><h2><code class="docutils literal notranslate"><span class="pre">with</span></code> connections and cursors<a class="headerlink" href="#with-connections-and-cursors" title="Permalink to this headline">¶</a></h2>
<p>Connections and cursors act as context managers, so you can run:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">psycopg3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;dbname=test user=postgres&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO test (num, data) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;abc&#39;def&quot;</span><span class="p">))</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="c1"># will return (1, 100, &quot;abc&#39;def&quot;)</span>

    <span class="c1"># the cursor is closed upon leaving the context</span>

<span class="c1"># the transaction is committed on successful exit of the context</span>
<span class="c1"># and the connection closed</span>
</pre></div>
</div>
<p>For asynchronous connections and cursor it’s <em>almost</em> what you’d expect, but
not quite. Please note that <code class="xref py py-obj docutils literal notranslate"><span class="pre">connect()</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor()</span></code> <em>don’t return a
context</em>: they are both factory methods which return <em>an object which can be
used as a context</em>. So you cannot use <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span> <span class="pre">connect()</span></code>: you have to do
it in two steps instead, as in</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">aconn</span> <span class="o">=</span> <span class="k">await</span> <span class="n">psycopg3</span><span class="o">.</span><span class="n">AsyncConnection</span><span class="o">.</span><span class="n">connect</span><span class="p">():</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">aconn</span><span class="p">:</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aconn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">cur</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>which can be condensed as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="p">(</span><span class="k">await</span> <span class="n">psycopg3</span><span class="o">.</span><span class="n">AsyncConnection</span><span class="o">.</span><span class="n">connect</span><span class="p">())</span> <span class="k">as</span> <span class="n">aconn</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="p">(</span><span class="k">await</span> <span class="n">aconn</span><span class="o">.</span><span class="n">cursor</span><span class="p">())</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>…but no less than that: you still need to do the double async thing.</p>
</div>
</div>
<div class="section" id="passing-parameters-to-sql-queries">
<span id="query-parameters"></span><span id="index-2"></span><h1>Passing parameters to SQL queries<a class="headerlink" href="#passing-parameters-to-sql-queries" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">psycopg3</span></code> converts Python variables to SQL values using their types: the
Python type determines the function used to convert the object into a string
representation suitable for PostgreSQL.  Many standard Python types are
<a class="reference internal" href="#python-types-adaptation">adapted out of the box</a> to the correct SQL representation.</p>
<p>Passing parameters to an SQL statement happens in functions such as
<a class="reference internal" href="cursor.html#psycopg3.Cursor.execute" title="psycopg3.Cursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Cursor.execute()</span></code></a> by using <code class="docutils literal notranslate"><span class="pre">%s</span></code> placeholders in the SQL statement, and
passing a sequence of values as the second argument of the function. For
example the Python function call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">    INSERT INTO some_table (an_int, a_date, a_string)</span>
<span class="gp">... </span><span class="s2">    VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">);</span>
<span class="gp">... </span><span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span> <span class="s2">&quot;O&#39;Reilly&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>is roughly equivalent to the SQL command:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">some_table</span> <span class="p">(</span><span class="n">an_int</span><span class="p">,</span> <span class="n">a_date</span><span class="p">,</span> <span class="n">a_string</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;2020-11-18&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;&#39;Reilly&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that the parameters will not be really merged to the query: query and the
parameters are sent to the server separately: see <a class="reference internal" href="from_pg2.html#server-side-binding"><span class="std std-ref">Server-side binding</span></a>
for details.</p>
<p>Named arguments are supported too using <code class="samp docutils literal notranslate"><span class="pre">%(</span><em><span class="pre">name</span></em><span class="pre">)s</span></code> placeholders in the
query and specifying the values into a mapping.  Using named arguments allows
to specify the values in any order and to repeat the same value in several
places in the query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">    INSERT INTO some_table (an_int, a_date, another_date, a_string)</span>
<span class="gp">... </span><span class="s2">    VALUES (</span><span class="si">%(int)s</span><span class="s2">, </span><span class="si">%(date)s</span><span class="s2">, </span><span class="si">%(date)s</span><span class="s2">, </span><span class="si">%(str)s</span><span class="s2">);</span>
<span class="gp">... </span><span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s2">&quot;O&#39;Reilly&quot;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">)})</span>
</pre></div>
</div>
<p>Using characters <code class="docutils literal notranslate"><span class="pre">%</span></code>, <code class="docutils literal notranslate"><span class="pre">(</span></code>, <code class="docutils literal notranslate"><span class="pre">)</span></code> in the argument names is not supported.</p>
<p>When parameters are used, in order to include a literal <code class="docutils literal notranslate"><span class="pre">%</span></code> in the query you
can use the <code class="docutils literal notranslate"><span class="pre">%%</span></code> string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT (</span><span class="si">%s</span><span class="s2"> % 2) = 0 AS even&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>       <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT (</span><span class="si">%s</span><span class="s2"> </span><span class="si">%%</span><span class="s2"> 2) = 0 AS even&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>      <span class="c1"># correct</span>
</pre></div>
</div>
<p>While the mechanism resembles regular Python strings manipulation, there are a
few subtle differences you should care about when passing parameters to a
query.</p>
<ul>
<li><p>The Python string operator <code class="docutils literal notranslate"><span class="pre">%</span></code> <em>must not be used</em>: the <code class="xref py py-obj docutils literal notranslate"><span class="pre">execute()</span></code>
method accepts a tuple or dictionary of values as second parameter.
<a class="reference internal" href="#sql-injection"><strong>Never</strong> use <code class="docutils literal notranslate"><span class="pre">%</span></code> or <code class="docutils literal notranslate"><span class="pre">+</span></code> to merge values
into queries</a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>  <span class="c1"># correct</span>
</pre></div>
</div>
</li>
<li><p>For positional variables binding, <em>the second argument must always be a
sequence</em>, even if it contains a single variable (remember that Python
requires a comma to create a single element tuple):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO foo VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">)</span>    <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO foo VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">))</span>  <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO foo VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,))</span> <span class="c1"># correct</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO foo VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">])</span>  <span class="c1"># correct</span>
</pre></div>
</div>
</li>
<li><p>The placeholder <em>must not be quoted</em>. Psycopg will add quotes where needed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span> <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>   <span class="c1"># correct</span>
</pre></div>
</div>
</li>
<li><p>The variables placeholder <em>must always be a</em> <code class="docutils literal notranslate"><span class="pre">%s</span></code>, even if a different
placeholder (such as a <code class="docutils literal notranslate"><span class="pre">%d</span></code> for integers or <code class="docutils literal notranslate"><span class="pre">%f</span></code> for floats) may look
more appropriate. Another placeholder used is <code class="docutils literal notranslate"><span class="pre">%b</span></code>, to <a class="reference internal" href="#binary-data"><span class="std std-ref">adapt the
object to binary type</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>   <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>   <span class="c1"># correct</span>
</pre></div>
</div>
</li>
<li><p>Only query values should be bound via this method: it shouldn’t be used to
merge table or field names to the query. If you need to generate dynamically
SQL queries (for instance choosing dynamically a table name) you can use the
facilities provided by the <a class="reference internal" href="sql.html#module-psycopg3.sql" title="psycopg3.sql"><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3.sql</span></code></a> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO </span><span class="si">%s</span><span class="s2"> VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;numbers&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>  <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>                                                <span class="c1"># correct</span>
<span class="gp">... </span>    <span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;INSERT INTO </span><span class="si">{}</span><span class="s2"> VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;numbers&#39;</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="the-problem-with-the-query-parameters">
<span id="sql-injection"></span><span id="index-3"></span><h2>The problem with the query parameters<a class="headerlink" href="#the-problem-with-the-query-parameters" title="Permalink to this headline">¶</a></h2>
<p>The SQL representation of many data types is often different from their Python
string representation. The typical example is with single quotes in strings:
in SQL single quotes are used as string literal delimiters, so the ones
appearing inside the string itself must be escaped, whereas in Python single
quotes can be left unescaped if the string is delimited by double quotes.</p>
<p>Because of the difference, sometime subtle, between the data types
representations, a naïve approach to query strings composition, such as using
Python strings concatenation, is a recipe for <em>terrible</em> problems:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">SQL</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO authors (name) VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="c1"># NEVER DO THIS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;O&#39;Reilly&quot;</span><span class="p">,</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">SQL</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span> <span class="c1"># THIS WILL FAIL MISERABLY</span>
<span class="go">SyntaxError: syntax error at or near &quot;Reilly&quot;</span>
</pre></div>
</div>
<p>If the variables containing the data to send to the database come from an
untrusted source (such as a form published on a web site) an attacker could
easily craft a malformed string, either gaining access to unauthorized data or
performing destructive operations on the database. This form of attack is
called <a class="reference external" href="https://en.wikipedia.org/wiki/SQL_injection">SQL injection</a> and is known to be one of the most widespread forms of
attack to database servers. Before continuing, please print <a class="reference external" href="https://xkcd.com/327/">this page</a> as a
memo and hang it onto your desk.</p>
<p>Psycopg can <a class="reference internal" href="#python-types-adaptation">automatically convert Python objects to SQL values</a>: using this
feature your code will be more robust and reliable. We must stress this point:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>Don’t merge manually values to a query: hackers from a foreign country
will break into your computer and steal not only your disks, but also
your cds, leaving you only with the three most embarrassing records you
ever bought. On tape.</p></li>
<li><p>If you use the <code class="docutils literal notranslate"><span class="pre">%</span></code> operator to merge values to a query, con artists
will seduce your cat, who will run away taking your credit card
and your sunglasses with them.</p></li>
<li><p>If you use <code class="docutils literal notranslate"><span class="pre">+</span></code> to merge a textual value to a string, bad guys in
balaclava will find their way to your fridge, drink all your beer, and
leave your toilet sit up and your toilet paper in the wrong orientation.</p></li>
<li><p>You don’t want to merge manually values to a query: <a class="reference internal" href="#query-parameters"><span class="std std-ref">use the
provided methods</span></a> instead.</p></li>
</ul>
</div>
<p>The correct way to pass variables in a SQL command is using the second
argument of the <a class="reference internal" href="cursor.html#psycopg3.Cursor.execute" title="psycopg3.Cursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Cursor.execute()</span></code></a> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">SQL</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO authors (name) VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span>  <span class="c1"># Note: no quotes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;O&#39;Reilly&quot;</span><span class="p">,</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">SQL</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>  <span class="c1"># Note: no % operator</span>
</pre></div>
</div>
</div>
<div class="section" id="adaptation-of-python-values-to-sql-types">
<span id="python-types-adaptation"></span><span id="index-4"></span><h2>Adaptation of Python values to SQL types<a class="headerlink" href="#adaptation-of-python-values-to-sql-types" title="Permalink to this headline">¶</a></h2>
<p>Many standard Python types are adapted into SQL and returned as Python
objects when a query is executed.</p>
<p>The following table shows the default mapping between Python and PostgreSQL
types:</p>
<p>TODO: complete table</p>
<table class="data-types docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 35%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Python</p></th>
<th class="head"><p>PostgreSQL</p></th>
<th class="head"><p>See also</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><span class="xref std std-ref">adapt-bool</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">real</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">double</span></code></div>
</div>
</td>
<td rowspan="3"><p><a class="reference external" href="https://www.psycopg.org/docs/usage.html#adapt-numbers" title="(in Psycopg v2.8)"><span>Numbers adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">smallint</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">integer</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">bigint</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Decimal" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decimal</span></code></a></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">numeric</span></code></p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">varchar</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">text</span></code></div>
</div>
</td>
<td><p><a class="reference external" href="https://www.psycopg.org/docs/usage.html#adapt-string" title="(in Psycopg v2.8)"><span>Strings adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code></a></div>
</div>
</td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">bytea</span></code></p></td>
<td><p><a class="reference external" href="https://www.psycopg.org/docs/usage.html#adapt-binary" title="(in Psycopg v2.8)"><span>Binary adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">date</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">date</span></code></p></td>
<td rowspan="4"><p><a class="reference external" href="https://www.psycopg.org/docs/usage.html#adapt-date" title="(in Psycopg v2.8)"><span>Date/Time objects adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">time</span></code></p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">time</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">timetz</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime</span></code></p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">timestamp</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">timestamptz</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">timedelta</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">interval</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">ARRAY</span></code></p></td>
<td><p><a class="reference external" href="https://www.psycopg.org/docs/usage.html#adapt-list" title="(in Psycopg v2.8)"><span>Lists adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code></div>
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">namedtuple</span></code></div>
</div>
</td>
<td><p>Composite types</p></td>
<td><p><a class="reference external" href="https://www.psycopg.org/docs/extras.html#adapt-composite" title="(in Psycopg v2.8)"><span>Composite types casting</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">hstore</span></code></p></td>
<td><p><a class="reference external" href="https://www.psycopg.org/docs/extras.html#adapt-hstore" title="(in Psycopg v2.8)"><span>Hstore data type</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>Psycopg’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">Range</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">range</span></code></p></td>
<td><p><a class="reference external" href="https://www.psycopg.org/docs/extras.html#adapt-range" title="(in Psycopg v2.8)"><span>Range data types</span></a></p></td>
</tr>
<tr class="row-even"><td><p>Anything™</p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">json</span></code></p></td>
<td><p><a class="reference external" href="https://www.psycopg.org/docs/extras.html#adapt-json" title="(in Psycopg v2.8)"><span>JSON adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://docs.python.org/3/library/uuid.html#uuid.UUID" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">UUID</span></code></a></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">uuid</span></code></p></td>
<td><p><a class="reference external" href="https://www.psycopg.org/docs/extras.html#adapt-uuid" title="(in Psycopg v2.8)"><span>UUID data type</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://docs.python.org/3/library/ipaddress.html#module-ipaddress" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ipaddress</span></code></a>
objects</p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">inet</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">cidr</span></code></div>
</div>
</td>
<td><p><a class="reference external" href="https://www.psycopg.org/docs/extras.html#adapt-network" title="(in Psycopg v2.8)"><span>Networking data types</span></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="binary-parameters-and-results">
<span id="binary-data"></span><span id="index-5"></span><h2>Binary parameters and results<a class="headerlink" href="#binary-parameters-and-results" title="Permalink to this headline">¶</a></h2>
<p>TODO</p>
<span class="target" id="index-6"></span><span class="target" id="index-7"></span></div>
</div>
<div class="section" id="transaction-management">
<span id="transactions"></span><span id="index-8"></span><h1>Transaction management<a class="headerlink" href="#transaction-management" title="Permalink to this headline">¶</a></h1>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> has a behaviour that may result surprising compared to
<strong class="program">psql</strong>: by default, any database operation will start a new
transaction. As a consequence, changes made by any cursor of the connection
will not be visible until <a class="reference internal" href="connection.html#psycopg3.Connection.commit" title="psycopg3.Connection.commit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection.commit()</span></code></a> is called, and will be
discarded by <a class="reference internal" href="connection.html#psycopg3.Connection.rollback" title="psycopg3.Connection.rollback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection.rollback()</span></code></a>. The following operation on the same
connection will start a new transaction.</p>
<p>If a database operation fails, the server will refuse further commands, until
a <code class="xref py py-obj docutils literal notranslate"><span class="pre">rollback()</span></code> is called.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If a database operation fails with an error message such as
<em>InFailedSqlTransaction: current transaction is aborted, commands ignored
until end of transaction block</em>, it means that <strong>a previous operation
failed</strong> and the database session is in a state of error. You need to call
<code class="xref py py-obj docutils literal notranslate"><span class="pre">rollback()</span></code> if you want to keep on using the same connection.</p>
</div>
<p>The manual commit requirement can be suspended using <a class="reference internal" href="connection.html#psycopg3.Connection.autocommit" title="psycopg3.Connection.autocommit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">autocommit</span></code></a>,
either as connection attribute or as <a class="reference internal" href="connection.html#psycopg3.Connection.connect" title="psycopg3.Connection.connect"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connect()</span></code></a>
parameter. This may be required to run operations that need to run outside a
transaction, such as <code class="sql docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">DATABASE</span></code>, <code class="sql docutils literal notranslate"><span class="pre">VACUUM</span></code>, <code class="sql docutils literal notranslate"><span class="pre">CALL</span></code> on
<a class="reference external" href="https://www.postgresql.org/docs/current/xproc.html">stored procedures</a> using transaction control.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>by default even a simple <code class="sql docutils literal notranslate"><span class="pre">SELECT</span></code> will start a transaction: in
long-running programs, if no further action is taken, the session will
remain <em>idle in transaction</em>, an undesirable condition for several
reasons (locks are held by the session, tables bloat…). For long lived
scripts, either make sure to terminate a transaction as soon as possible or
use an <a class="reference internal" href="connection.html#psycopg3.Connection.autocommit" title="psycopg3.Connection.autocommit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">autocommit</span></code></a> connection.</p>
</div>
<div class="section" id="transaction-blocks">
<span id="transaction-block"></span><h2>Transaction blocks<a class="headerlink" href="#transaction-blocks" title="Permalink to this headline">¶</a></h2>
<p>A more transparent way to make sure that transactions are finalised at the
right time is to use <code class="docutils literal notranslate"><span class="pre">with</span></code> <a class="reference internal" href="connection.html#psycopg3.Connection.transaction" title="psycopg3.Connection.transaction"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection.transaction()</span></code></a> to create a
transaction block. When the block is entered a transaction is started; when
leaving the block the transaction is committed, or it is rolled back if an
exception is raised inside the block.</p>
<p>For instance, an hypothetical but extremely secure bank may have the following
code to avoid that no accident between the following two lines leaves the
accounts unbalanced:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="n">move_money</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">account1</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">move_money</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">account2</span><span class="p">,</span> <span class="o">+</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># The transaction is now committed</span>
</pre></div>
</div>
<p>But because the bank is, like, <em>extremely secure</em>, they also verify that no
account goes negative:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">move_money</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
    <span class="n">new_balance</span> <span class="o">=</span> <span class="n">add_to_balance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new_balance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;account balance cannot go negative&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In case this function raises an exception, be it the <code class="xref py py-obj docutils literal notranslate"><span class="pre">ValueError</span></code> in the
example or any other exception expected or not, the transaction will be rolled
back, and the exception will propagate out of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">with</span></code> block, further down
the call stack.</p>
<p>Transaction blocks can also be nested (internal transaction blocks are
implemented using <a class="reference external" href="https://www.postgresql.org/docs/current/sql-savepoint.html">SAVEPOINT</a>): an exception raised inside an inner block
has a chance of being handled and not completely fail outer operations. The
following is an example where a series of operations interact with the
database: operations are allowed to fail, plus we also want to store the
number of operations successfully processed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx1</span><span class="p">:</span>
    <span class="n">num_ok</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx2</span><span class="p">:</span>
                <span class="n">unreliable_operation</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2"> failed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_ok</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">save_number_of_successes</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">num_ok</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="xref py py-obj docutils literal notranslate"><span class="pre">unreliable_operation()</span></code> causes an error, including an operation causing a
database error, all its changes will be reverted. The exception bubbles up
outside the block: in the example it is intercepted by the <code class="docutils literal notranslate"><span class="pre">try</span></code> so that the
loop can complete. The outermost block is unaffected (unless other errors
happen there).</p>
<p>You can also write code to explicitly roll back any currently active
transaction block, by raising the <a class="reference internal" href="connection.html#psycopg3.Rollback" title="psycopg3.Rollback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Rollback</span></code></a> exception. The exception “jumps”
to the end of a transaction block, rolling back its transaction but allowing
the program execution to continue from there. By default the exception rolls
back the innermost transaction block, but any current block can be specified
as the target. In the following example, an hypothetical <code class="xref py py-obj docutils literal notranslate"><span class="pre">CancelCommand</span></code>
may stop the processing and cancel any operation previously performed,
but not entirely committed yet.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">psycopg3</span> <span class="kn">import</span> <span class="n">Rollback</span>

<span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">outer_tx</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">inner_tx</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">CancelCommand</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">Rollback</span><span class="p">(</span><span class="n">outer_tx</span><span class="p">)</span>
        <span class="n">process_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

<span class="c1"># If `Rollback` is raised, it would propagate only up to this block,</span>
<span class="c1"># and the program would continue from here with no exception.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-copy-to-and-copy-from">
<span id="copy"></span><span id="index-9"></span><h1>Using COPY TO and COPY FROM<a class="headerlink" href="#using-copy-to-and-copy-from" title="Permalink to this headline">¶</a></h1>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> allows to operate with <a class="reference external" href="https://www.postgresql.org/docs/current/sql-copy.html">PostgreSQL COPY protocol</a>. <code class="sql docutils literal notranslate"><span class="pre">COPY</span></code> is
one of the most efficient ways to load data into the database (and to modify
it, with some SQL creativity).</p>
<p>Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> you can do three things:</p>
<ul class="simple">
<li><p>loading data into the database row-by-row, from a stream of Python objects;</p></li>
<li><p>loading data into the database block-by-block, with data already formatted in
a way suitable for <code class="sql docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">FROM</span></code>;</p></li>
<li><p>reading data from the database block-by-block, with data emitted by a
<code class="sql docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">TO</span></code> statement.</p></li>
</ul>
<p>The missing quadrant, copying data from the database row-by-row, is not
covered by COPY because that’s pretty much normal querying, and <code class="sql docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">TO</span></code>
doesn’t offer enough metadata to decode the data to Python objects.</p>
<p>The first option is the most powerful, because it allows to load data into the
database from any Python iterable (a list of tuple, or any iterable of
sequences): the Python values are adapted as they would be in normal querying.
To perform such operation use a <code class="sql docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">[table]</span> <span class="pre">FROM</span> <span class="pre">STDIN</span></code> with
<a class="reference internal" href="cursor.html#psycopg3.Cursor.copy" title="psycopg3.Cursor.copy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Cursor.copy()</span></code></a> and use <a class="reference internal" href="cursor.html#psycopg3.Copy.write_row" title="psycopg3.Copy.write_row"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_row()</span></code></a> on the resulting object in a
<code class="docutils literal notranslate"><span class="pre">with</span></code> block. On exiting the block the operation will be concluded:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">cursor</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;COPY table_name (col1, col2) FROM STDIN&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">copy</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">write_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>If an exception is raised inside the block, the operation is interrupted and
the records inserted so far discarded.</p>
<p>If data is already formatted in a way suitable for copy (for instance because
it is coming from a file resulting from a previous <code class="xref py py-obj docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">TO</span></code> operation) it can
be loaded using <a class="reference internal" href="cursor.html#psycopg3.Copy.write" title="psycopg3.Copy.write"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Copy.write()</span></code></a> instead.</p>
<p>In order to read data in <code class="sql docutils literal notranslate"><span class="pre">COPY</span></code> format you can use a <code class="sql docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">TO</span>
<span class="pre">STDOUT</span></code> statement and iterate over the resulting <a class="reference internal" href="cursor.html#psycopg3.Copy" title="psycopg3.Copy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Copy</span></code></a> object, which will
produce <code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data.out&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">cursor</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;COPY table_name TO STDOUT&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">copy</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>Asynchronous operations are supported using the same patterns on an
<a class="reference internal" href="connection.html#psycopg3.AsyncConnection" title="psycopg3.AsyncConnection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnection</span></code></a>. For instance, if <code class="xref py py-obj docutils literal notranslate"><span class="pre">f</span></code> is an object supporting an
asynchronous <code class="xref py py-obj docutils literal notranslate"><span class="pre">read()</span></code> method returning <code class="sql docutils literal notranslate"><span class="pre">COPY</span></code> data, a fully-async copy
operation could be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">cursor</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;COPY data FROM STDIN&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">copy</span><span class="p">:</span>
    <span class="k">while</span> <span class="n">data</span> <span class="o">:=</span> <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">copy</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>Binary data can be produced and consumed using <code class="sql docutils literal notranslate"><span class="pre">FORMAT</span> <span class="pre">BINARY</span></code> in the
<code class="sql docutils literal notranslate"><span class="pre">COPY</span></code> command: see <a class="reference internal" href="#binary-data"><span class="std std-ref">Binary parameters and results</span></a> for details and limitations.</p>
</div>
<div class="section" id="async-operations">
<span id="index-10"></span><h1>Async operations<a class="headerlink" href="#async-operations" title="Permalink to this headline">¶</a></h1>
<p>psycopg3 <a class="reference internal" href="connection.html#psycopg3.Connection" title="psycopg3.Connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection</span></code></a> and <a class="reference internal" href="cursor.html#psycopg3.Cursor" title="psycopg3.Cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Cursor</span></code></a> have counterparts <a class="reference internal" href="connection.html#psycopg3.AsyncConnection" title="psycopg3.AsyncConnection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnection</span></code></a> and
<a class="reference internal" href="cursor.html#psycopg3.AsyncCursor" title="psycopg3.AsyncCursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncCursor</span></code></a> supporting an <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">asyncio</span></code></a> interface.</p>
<p>The design of the asynchronous objects is pretty much the same of the sync
ones: in order to use them you will only have to scatter the <code class="docutils literal notranslate"><span class="pre">await</span></code> keyword
here and there.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="k">await</span> <span class="n">psycopg3</span><span class="o">.</span><span class="n">AsyncConnection</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="s2">&quot;dbname=test user=postgres&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">aconn</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="k">await</span> <span class="n">aconn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">acur</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">acur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO test (num, data) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;abc&#39;def&quot;</span><span class="p">))</span>
        <span class="k">await</span> <span class="n">acur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM test&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">acur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="c1"># will return (1, 100, &quot;abc&#39;def&quot;)</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">acur</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="asynchronous-notifications">
<span id="async-notify"></span><span id="index-11"></span><h2>Asynchronous notifications<a class="headerlink" href="#asynchronous-notifications" title="Permalink to this headline">¶</a></h2>
<p>Psycopg allows asynchronous interaction with other database sessions using the
facilities offered by PostgreSQL commands <a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-listen.html"><code class="sql docutils literal notranslate"><span class="pre">LISTEN</span></code></a> and <a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-notify.html"><code class="sql docutils literal notranslate"><span class="pre">NOTIFY</span></code></a>. Please
refer to the PostgreSQL documentation for examples about how to use this form
of communication.</p>
<p>Because of the way sessions interact with notifications (see <a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-notify.html"><code class="sql docutils literal notranslate"><span class="pre">NOTIFY</span></code></a>
documentation), you should keep the connection in <a class="reference internal" href="connection.html#psycopg3.Connection.autocommit" title="psycopg3.Connection.autocommit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">autocommit</span></code></a>
mode if you wish to receive or send notifications in a timely manner.</p>
<p>Notifications are received as instances of <a class="reference internal" href="connection.html#psycopg3.Notify" title="psycopg3.Notify"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Notify</span></code></a>. If you are reserving a
connection only to receive notifications, the simplest way is to consume the
<a class="reference internal" href="connection.html#psycopg3.Connection.notifies" title="psycopg3.Connection.notifies"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection.notifies</span></code></a> generator. The generator can be stopped using
<code class="docutils literal notranslate"><span class="pre">close()</span></code>. The following example will print notifications and stop when one
containing the <code class="docutils literal notranslate"><span class="pre">stop</span></code> message is received.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg3</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">autocommit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;LISTEN mychan&quot;</span><span class="p">)</span>
<span class="n">gen</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">notifies</span><span class="p">()</span>
<span class="k">for</span> <span class="n">notify</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">notify</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">notify</span><span class="o">.</span><span class="n">payload</span> <span class="o">==</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span>
        <span class="n">gen</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;there, I stopped&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you run some <code class="sql docutils literal notranslate"><span class="pre">NOTIFY</span></code> in a <strong class="program">psql</strong> session:</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="gp">=#</span> <span class="k">notify</span> <span class="n">mychan</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">;</span>
<span class="go">NOTIFY</span>
<span class="gp">=#</span> <span class="k">notify</span> <span class="n">mychan</span><span class="p">,</span> <span class="s1">&#39;hey&#39;</span><span class="p">;</span>
<span class="go">NOTIFY</span>
<span class="gp">=#</span> <span class="k">notify</span> <span class="n">mychan</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">;</span>
<span class="go">NOTIFY</span>
</pre></div>
</div>
<p>You may get output from the Python process such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Notify</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s1">&#39;mychan&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="mi">961823</span><span class="p">)</span>
<span class="n">Notify</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s1">&#39;mychan&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="s1">&#39;hey&#39;</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="mi">961823</span><span class="p">)</span>
<span class="n">Notify</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s1">&#39;mychan&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="mi">961823</span><span class="p">)</span>
<span class="n">there</span><span class="p">,</span> <span class="n">I</span> <span class="n">stopped</span>
</pre></div>
</div>
<p>Alternatively, you can use <a class="reference internal" href="connection.html#psycopg3.Connection.add_notify_handler" title="psycopg3.Connection.add_notify_handler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">add_notify_handler()</span></code></a> to register a
callback function, which will be invoked whenever a notification is received,
during the normal query processing; you will be then able to use the
connection normally. Please note that in this case notifications will not be
received immediately, but only during a connection operation, such as a query.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">add_notify_handler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;got this: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

<span class="c1"># meanwhile in psql...</span>
<span class="c1"># =# notify mychan, &#39;hey&#39;;</span>
<span class="c1"># NOTIFY</span>

<span class="nb">print</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select 1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">())</span>
<span class="c1"># got this: Notify(channel=&#39;mychan&#39;, payload=&#39;hey&#39;, pid=961823)</span>
<span class="c1"># (1,)</span>
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Basic module usage</a><ul>
<li><a class="reference internal" href="#with-connections-and-cursors"><code class="docutils literal notranslate"><span class="pre">with</span></code> connections and cursors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#passing-parameters-to-sql-queries">Passing parameters to SQL queries</a><ul>
<li><a class="reference internal" href="#the-problem-with-the-query-parameters">The problem with the query parameters</a></li>
<li><a class="reference internal" href="#adaptation-of-python-values-to-sql-types">Adaptation of Python values to SQL types</a></li>
<li><a class="reference internal" href="#binary-parameters-and-results">Binary parameters and results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transaction-management">Transaction management</a><ul>
<li><a class="reference internal" href="#transaction-blocks">Transaction blocks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-copy-to-and-copy-from">Using COPY TO and COPY FROM</a></li>
<li><a class="reference internal" href="#async-operations">Async operations</a><ul>
<li><a class="reference internal" href="#asynchronous-notifications">Asynchronous notifications</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="connection.html"
                        title="next chapter">Connection classes</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/usage.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<form class="search" action="search.html" method="get">
  <input type="text" name="q"
   placeholder="type to search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="install.html" title="Previous document">Installation</a>
        </li>
        <li>
          <a href="connection.html" title="Next document">Connection classes</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="index.html">psycopg3 UNRELEASED documentation</a></li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; 2020, Daniele Varrazzo and The Psycopg Team.

  </footer>

  
  </body>
</html>