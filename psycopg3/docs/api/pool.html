<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="types – types mapping and adaptation" href="types.html" /><link rel="prev" title="errors – package exceptions" href="errors.html" />

    <meta name="generator" content="sphinx-3.3.1, furo 2021.02.28.beta28"/>
        <title>pool – Connection pool implementations - psycopg3 UNRELEASED documentation</title>
      <link rel="stylesheet" href="../_static/styles/furo.css?digest=be5985a4059b5c2cd56ed0804790452beca62674">
    <link rel="stylesheet" href="../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 1rem;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 1rem;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../_static/psycopg.css" />
    <link rel="stylesheet" href="../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<div class="announcement">
  <aside class="announcement-content">
     <a style="text-decoration: none; color: white;"
   href="https://github.com/sponsors/dvarrazzo/">
   <img height="24px" width="24px" src="/img/logo/psycopg-48.png"/>
    Sponsor psycopg3 on GitHub
</a>
 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">psycopg3 UNRELEASED documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/psycopg.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/psycopg.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">psycopg3 UNRELEASED documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../basic/index.html">Getting started with <code class="docutils literal notranslate"><span class="pre">psycopg3</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic/install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/usage.html">Basic module usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/params.html">Passing parameters to SQL queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/adapt.html">Adaptation between Python and PostgreSQL types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/transactions.html">Transaction management</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced/index.html">Advanced topics</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../advanced/async.html">Async operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/copy.html">Using COPY TO and COPY FROM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/cursors.html">Cursor types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/rows.html">Row factories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/pool.html">Connection pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/adapt.html">Data adaptation configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/prepare.html">Prepared statements</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html"><code class="docutils literal notranslate"><span class="pre">psycopg3</span></code> API</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="connections.html">Connection classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="cursors.html">Cursor classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sql</span></code> – SQL string composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">errors</span></code> – package exceptions</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pool</span></code> – Connection pool implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">types</span></code> – types mapping and adaptation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pq.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pq</span></code> – libpq wrapper module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../from_pg2.html">Differences from <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code></a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="pool-connection-pool-implementations">
<h1><code class="xref py py-obj docutils literal notranslate"><span class="pre">pool</span></code> – Connection pool implementations<a class="headerlink" href="#pool-connection-pool-implementations" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-psycopg3.pool"><span id="index-0"></span></span><p>The package contains two connection pool implementations. A connection pool
creates and maintains a limited amount of <a class="reference internal" href="connections.html#psycopg3.Connection" title="psycopg3.Connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection</span></code></a> instances and
allows a larger number of users to use them. See <a class="reference internal" href="../advanced/pool.html#connection-pools"><span class="std std-ref">Connection pools</span></a> for
more details and usage pattern.</p>
<p>There package implement two connection pools: <a class="reference internal" href="#psycopg3.pool.ConnectionPool" title="psycopg3.pool.ConnectionPool"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ConnectionPool</span></code></a> is a
synchronous connection pool yielding <a class="reference internal" href="connections.html#psycopg3.Connection" title="psycopg3.Connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection</span></code></a> objects and can be
used by multithread applications. <a class="reference internal" href="#psycopg3.pool.AsyncConnectionPool" title="psycopg3.pool.AsyncConnectionPool"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnectionPool</span></code></a> has a similar
interface, but with <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">asyncio</span></code></a> functions replacing blocking functions, and
yields <a class="reference internal" href="connections.html#psycopg3.AsyncConnection" title="psycopg3.AsyncConnection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnection</span></code></a> instances.</p>
<p>The intended use (but not mandatory) is to create a single connection pool, as
a global object exposed by a module in your application, and use the same
instance from the rest of the code (especially the
<a class="reference internal" href="#psycopg3.pool.ConnectionPool.connection" title="psycopg3.pool.ConnectionPool.connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection()</span></code></a> method.</p>
<div class="section" id="the-connectionpool-class">
<h2>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">ConnectionPool</span></code> class<a class="headerlink" href="#the-connectionpool-class" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="psycopg3.pool.ConnectionPool">
<em class="property">class </em><code class="sig-prename descclassname">psycopg3.pool.</code><code class="sig-name descname">ConnectionPool</code><span class="sig-paren">(</span><em class="sig-param">conninfo</em>, <em class="sig-param">*</em>, <em class="sig-param">**arguments</em><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.ConnectionPool" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements a connection pool serving <code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection</span></code>
instances (or subclasses).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>conninfo</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – The connection string. See
<a class="reference internal" href="connections.html#psycopg3.Connection.connect" title="psycopg3.Connection.connect"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connect()</span></code></a> for details.</p></li>
<li><p><strong>minconn</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – The minimum number of connection the pool will hold. The
pool will actively try to create new connections if some
are lost (closed, broken) and will try to never go below
<em>minconn</em>. Default: 4</p></li>
<li><p><strong>maxconn</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">Optional[int]</span></code>) – The maximum number of connections the pool will hold. If
<code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>, or equal to <em>minconn</em>, the pool will not grow or
shrink. If larger than <em>minconn</em> the pool can grow if more
than <em>minconn</em> connections are requested at the same time
and will shrink back after the extra connections have been
unused for more than <em>max_idle</em> seconds. Default: <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>kwargs</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code>) – Extra arguments to pass to <code class="xref py py-obj docutils literal notranslate"><span class="pre">connect()</span></code>. Note that this is
<em>one dict argument</em> of the pool constructor, which is
expanded as <code class="xref py py-obj docutils literal notranslate"><span class="pre">connect()</span></code> keyword parameters.</p></li>
<li><p><strong>configure</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">Callable[[Connection],</span> <span class="pre">None]</span></code>) – A callback to configure a connection after creation.
Useful, for instance, to configure its adapters. If the
connection is used to run internal queries (to inspect the
database) make sure to close an eventual transaction
before leaving the function.</p></li>
<li><p><strong>reset</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">Callable[[Connection],</span> <span class="pre">None]</span></code>) – A callback to reset a function after it has been returned to
the pool. The connection is guaranteed to be passed to the
<em>reset()</em> function in “idle” state (no transaction). When
leaving the <em>reset()</em> function the connection must be left in
<em>idle</em> state, otherwise is discarded.</p></li>
<li><p><strong>connection_class</strong> (<code class="docutils literal notranslate"><span class="pre">Type[Connection]</span></code>) – The class of the connections to serve. Default:
<a class="reference internal" href="connections.html#psycopg3.Connection" title="psycopg3.Connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection</span></code></a>. It should be a
<code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection</span></code> subclass.</p></li>
<li><p><strong>name</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – An optional name to give to the pool, useful, for instance, to
identify it in the logs if more than one pool is used. If
<code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code> (default) pick a sequential name such as <code class="docutils literal notranslate"><span class="pre">pool-1</span></code>,
<code class="docutils literal notranslate"><span class="pre">pool-2</span></code> etc.</p></li>
<li><p><strong>timeout</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – The default maximum time in seconts that a client can wait
to receive a connection from the pool (using <a class="reference internal" href="#psycopg3.pool.ConnectionPool.connection" title="psycopg3.pool.ConnectionPool.connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection()</span></code></a>
or <a class="reference internal" href="#psycopg3.pool.ConnectionPool.getconn" title="psycopg3.pool.ConnectionPool.getconn"><code class="xref py py-obj docutils literal notranslate"><span class="pre">getconn()</span></code></a>). Note that these methods allow to override
the <em>timeout</em> default. Default: 30 seconds.</p></li>
<li><p><strong>max_lifetime</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – The maximum lifetime of a connection in the pool, in
seconds. Connections used for longer get closed and
replaced by a new one. The amount is reduced by a
random 10% to avoid mass eviction. Default: one hour.</p></li>
<li><p><strong>max_idle</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – Maximum time a connection can be unused in the pool before
being closed, and the pool shrunk. This only happens to
connections more than <em>minconn</em>, if <em>maxconn</em> allowed the
pool to grow. Default: 10 minutes.</p></li>
<li><p><strong>reconnect_timeout</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – Maximum time in seconds the pool will try to
create a connection. If a connection attempt
fails, the pool will try to reconnect a few
times, using an exponential backoff and some
random factor to avoid mass attempts. If repeated
attempt fails, after <em>reconnect_timeout</em> second
the attempt is aborted and the <em>reconnect_failed</em>
callback invoked. Default: 5 minutes.</p></li>
<li><p><strong>reconnect_failed</strong> (<code class="docutils literal notranslate"><span class="pre">Callable[[ConnectionPool],</span> <span class="pre">None]</span></code>) – Callback invoked if an attempt to create a new
connection fails for more than <em>reconnect_timeout</em>
seconds. The user may decide, for instance, to
terminate the program (executing <code class="xref py py-obj docutils literal notranslate"><span class="pre">sys.exit()</span></code>).
By default don’t do anything: restart a new
connection attempt (if the number of connection
fell below <em>minconn</em>).</p></li>
<li><p><strong>num_workers</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – Number of background worker threads used to maintain the
pool state. Background workers are used for example to
create new connections and to clean up connections when
they are returned to the pool. Default: 3.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.wait">
<code class="sig-name descname">wait</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a></span> <span class="o">=</span> <span class="default_value">30.0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.ConnectionPool.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for the pool to be full (with <a class="reference internal" href="#psycopg3.pool.ConnectionPool.minconn" title="psycopg3.pool.ConnectionPool.minconn"><code class="xref py py-obj docutils literal notranslate"><span class="pre">minconn</span></code></a> connections) after creation.</p>
<p>Raise <a class="reference internal" href="#psycopg3.pool.PoolTimeout" title="psycopg3.pool.PoolTimeout"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PoolTimeout</span></code></a> if not ready within <em>timeout</em> sec.</p>
<p>Calling this method is not mandatory: you can try and use the pool
immediately after its creation. The first client will be served as soon
as a connection is ready. You can use this method if you prefer your
program to terminate in case the environment is not configured
properly, rather than trying to stay up the harder it can.</p>
</dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.connection">
<code class="sig-name descname">connection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> → Iterator<span class="p">[</span><a class="reference internal" href="connections.html#psycopg3.Connection" title="psycopg3.Connection">psycopg3.Connection</a><span class="p">]</span><a class="headerlink" href="#psycopg3.pool.ConnectionPool.connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Context manager to obtain a connection from the pool.</p>
<p>Returned the connection immediately if available, otherwise wait up to
<em>timeout</em> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.timeout</span></code> and throw <a class="reference internal" href="#psycopg3.pool.PoolTimeout" title="psycopg3.pool.PoolTimeout"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PoolTimeout</span></code></a> if a connection is
not available in time.</p>
<p>Upon context exit, return the connection to the pool. Apply the normal
<a class="reference internal" href="../basic/usage.html#with-connection"><span class="std std-ref">connection context behaviour</span></a> (commit/rollback
the transaction in case of success/error). If the connection is no more
in working state replace it with a new one.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">my_pool</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># the connection is now back in the pool</span>
</pre></div>
</div>
</dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a></span> <span class="o">=</span> <span class="default_value">5.0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.ConnectionPool.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close the pool and make it unavailable to new clients.</p>
<p>All the waiting and future client will fail to acquire a connection
with a <a class="reference internal" href="#psycopg3.pool.PoolClosed" title="psycopg3.pool.PoolClosed"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PoolClosed</span></code></a> exception. Currently used connections will not be
closed until returned to the pool.</p>
<p>Wait <em>timeout</em> for threads to terminate their job, if positive. If
timeout expires the pool is closed anyway, although it may raise some
warnings on exit.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pool can be used as context manager too, in which case it will
be closed at the end of the block:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ConnectionPool</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="c1"># code using the pool</span>
</pre></div>
</div>
</div>
</dd></dl>
<dl class="py attribute">
<dt id="psycopg3.pool.ConnectionPool.name">
<code class="sig-name descname">name</code><em class="property">: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></em><a class="headerlink" href="#psycopg3.pool.ConnectionPool.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the pool set on creation, or automatically generated if not
set.</p>
</dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.minconn">
<em class="property">property </em><code class="sig-name descname">minconn</code><a class="headerlink" href="#psycopg3.pool.ConnectionPool.minconn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.maxconn">
<em class="property">property </em><code class="sig-name descname">maxconn</code><a class="headerlink" href="#psycopg3.pool.ConnectionPool.maxconn" title="Permalink to this definition">¶</a></dt>
<dd><p>The current minimum and maximum size of the pool. Use <a class="reference internal" href="#psycopg3.pool.ConnectionPool.resize" title="psycopg3.pool.ConnectionPool.resize"><code class="xref py py-obj docutils literal notranslate"><span class="pre">resize()</span></code></a> to
change them at runtime.</p>
</dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.resize">
<code class="sig-name descname">resize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">minconn</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a></span></em>, <em class="sig-param"><span class="n">maxconn</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.ConnectionPool.resize" title="Permalink to this definition">¶</a></dt>
<dd><p>Change the size of the pool during runtime.</p>
</dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.check">
<code class="sig-name descname">check</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.ConnectionPool.check" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the state of the connections currently in the pool.</p>
<p>Test each connection: if it works return it to the pool, otherwise
dispose of it and create a new one.</p>
</dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.get_stats">
<code class="sig-name descname">get_stats</code><span class="sig-paren">(</span><span class="sig-paren">)</span> → Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><span class="p">]</span><a class="headerlink" href="#psycopg3.pool.ConnectionPool.get_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Return current stats about the pool usage.</p>
</dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.pop_stats">
<code class="sig-name descname">pop_stats</code><span class="sig-paren">(</span><span class="sig-paren">)</span> → Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><span class="p">]</span><a class="headerlink" href="#psycopg3.pool.ConnectionPool.pop_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Return current stats about the pool usage.</p>
<p>After the call, all the counters are reset to zero.</p>
<p>See <a class="reference internal" href="../advanced/pool.html#pool-stats"><span class="std std-ref">Pool stats</span></a> for the metrics returned.</p>
</dd></dl>
<p class="rubric">Functionalities you may not need</p>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.getconn">
<code class="sig-name descname">getconn</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> → <a class="reference internal" href="connections.html#psycopg3.Connection" title="psycopg3.Connection">psycopg3.Connection</a><a class="headerlink" href="#psycopg3.pool.ConnectionPool.getconn" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtain a contection from the pool.</p>
<p>You should preferrably use <a class="reference internal" href="#psycopg3.pool.ConnectionPool.connection" title="psycopg3.pool.ConnectionPool.connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection()</span></code></a>. Use this function only if
it is not possible to use the connection as context manager.</p>
<p>After using this function you <em>must</em> call a corresponding <a class="reference internal" href="#psycopg3.pool.ConnectionPool.putconn" title="psycopg3.pool.ConnectionPool.putconn"><code class="xref py py-obj docutils literal notranslate"><span class="pre">putconn()</span></code></a>:
failing to do so will deplete the pool. A depleted pool is a sad pool:
you don’t want a depleted pool.</p>
</dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.ConnectionPool.putconn">
<code class="sig-name descname">putconn</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">conn</span><span class="p">:</span> <span class="n"><a class="reference internal" href="connections.html#psycopg3.Connection" title="psycopg3.Connection">psycopg3.Connection</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.ConnectionPool.putconn" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a connection to the loving hands of its pool.</p>
<p>Use this function only paired with a <a class="reference internal" href="#psycopg3.pool.ConnectionPool.getconn" title="psycopg3.pool.ConnectionPool.getconn"><code class="xref py py-obj docutils literal notranslate"><span class="pre">getconn()</span></code></a>. You don’t need to use
it if you use the much more comfortable <a class="reference internal" href="#psycopg3.pool.ConnectionPool.connection" title="psycopg3.pool.ConnectionPool.connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection()</span></code></a> context manager.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt id="psycopg3.pool.PoolTimeout">
<em class="property">class </em><code class="sig-prename descclassname">psycopg3.pool.</code><code class="sig-name descname">PoolTimeout</code><a class="headerlink" href="#psycopg3.pool.PoolTimeout" title="Permalink to this definition">¶</a></dt>
<dd><p>The pool couldn’t provide a connection in acceptable time.</p>
<p>Subclass of <a class="reference internal" href="errors.html#psycopg3.OperationalError" title="psycopg3.OperationalError"><code class="xref py py-obj docutils literal notranslate"><span class="pre">OperationalError</span></code></a></p>
</dd></dl>
<dl class="py class">
<dt id="psycopg3.pool.PoolClosed">
<em class="property">class </em><code class="sig-prename descclassname">psycopg3.pool.</code><code class="sig-name descname">PoolClosed</code><a class="headerlink" href="#psycopg3.pool.PoolClosed" title="Permalink to this definition">¶</a></dt>
<dd><p>Attempt to get a connection from a closed pool.</p>
<p>Subclass of <a class="reference internal" href="errors.html#psycopg3.OperationalError" title="psycopg3.OperationalError"><code class="xref py py-obj docutils literal notranslate"><span class="pre">OperationalError</span></code></a></p>
</dd></dl>
</div>
<div class="section" id="the-asyncconnectionpool-class">
<h2>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnectionPool</span></code> class<a class="headerlink" href="#the-asyncconnectionpool-class" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnectionPool</span></code> has a very similar interface to the <a class="reference internal" href="#psycopg3.pool.ConnectionPool" title="psycopg3.pool.ConnectionPool"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ConnectionPool</span></code></a>
class but its blocking method are implemented as <code class="xref py py-obj docutils literal notranslate"><span class="pre">async</span></code> coroutines. It
returns <code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnection</span></code> instances, or its subclasses if specified so in the
<em>connection_class</em> parameter.</p>
<p>Only the function with different signature from <code class="xref py py-obj docutils literal notranslate"><span class="pre">ConnectionPool</span></code> are
listed here.</p>
<dl class="py class">
<dt id="psycopg3.pool.AsyncConnectionPool">
<em class="property">class </em><code class="sig-prename descclassname">psycopg3.pool.</code><code class="sig-name descname">AsyncConnectionPool</code><span class="sig-paren">(</span><em class="sig-param">conninfo</em>, <em class="sig-param">*</em>, <em class="sig-param">**arguments</em><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.AsyncConnectionPool" title="Permalink to this definition">¶</a></dt>
<dd><p>All the other parameters are the same.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>configure</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">async</span> <span class="pre">Callable[[AsyncConnection],</span> <span class="pre">None]</span></code>) – A callback to configure a connection after creation.</p></li>
<li><p><strong>reset</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">async</span> <span class="pre">Callable[[AsyncConnection],</span> <span class="pre">None]</span></code>) – A callback to reset a function after it has been returned to
the pool.</p></li>
<li><p><strong>connection_class</strong> (<code class="docutils literal notranslate"><span class="pre">Type[AsyncConnection]</span></code>) – The class of the connections to serve. Default:
<a class="reference internal" href="connections.html#psycopg3.AsyncConnection" title="psycopg3.AsyncConnection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnection</span></code></a>. It should be an
<code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnection</span></code> subclass.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="psycopg3.pool.AsyncConnectionPool.wait">
<em class="property">async </em><code class="sig-name descname">wait</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a></span> <span class="o">=</span> <span class="default_value">30.0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.AsyncConnectionPool.wait" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.AsyncConnectionPool.connection">
<code class="sig-name descname">connection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> → AsyncIterator<span class="p">[</span><a class="reference internal" href="connections.html#psycopg3.AsyncConnection" title="psycopg3.AsyncConnection">psycopg3.AsyncConnection</a><span class="p">]</span><a class="headerlink" href="#psycopg3.pool.AsyncConnectionPool.connection" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">my_pool</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># the connection is now back in the pool</span>
</pre></div>
</div>
</dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.AsyncConnectionPool.close">
<em class="property">async </em><code class="sig-name descname">close</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a></span> <span class="o">=</span> <span class="default_value">5.0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.AsyncConnectionPool.close" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pool can be used as context manager too, in which case it will
be closed at the end of the block:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncConnectionPool</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="c1"># code using the pool</span>
</pre></div>
</div>
</div>
</dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.AsyncConnectionPool.resize">
<em class="property">async </em><code class="sig-name descname">resize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">minconn</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a></span></em>, <em class="sig-param"><span class="n">maxconn</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.AsyncConnectionPool.resize" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.AsyncConnectionPool.check">
<em class="property">async </em><code class="sig-name descname">check</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.AsyncConnectionPool.check" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.AsyncConnectionPool.getconn">
<em class="property">async </em><code class="sig-name descname">getconn</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> → <a class="reference internal" href="connections.html#psycopg3.AsyncConnection" title="psycopg3.AsyncConnection">psycopg3.AsyncConnection</a><a class="headerlink" href="#psycopg3.pool.AsyncConnectionPool.getconn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py method">
<dt id="psycopg3.pool.AsyncConnectionPool.putconn">
<em class="property">async </em><code class="sig-name descname">putconn</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">conn</span><span class="p">:</span> <span class="n"><a class="reference internal" href="connections.html#psycopg3.AsyncConnection" title="psycopg3.AsyncConnection">psycopg3.AsyncConnection</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#psycopg3.pool.AsyncConnectionPool.putconn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
</dd></dl>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="types.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><code class="xref py py-obj docutils literal notranslate"><span class="pre">types</span></code> – types mapping and adaptation</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="errors.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><code class="xref py py-obj docutils literal notranslate"><span class="pre">errors</span></code> – package exceptions</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2020-2021, Daniele Varrazzo and The Psycopg Team
            |
            <a class="muted-link" href="../_sources/api/pool.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pool</span></code> – Connection pool implementations</a><ul>
<li><a class="reference internal" href="#the-connectionpool-class">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">ConnectionPool</span></code> class</a></li>
<li><a class="reference internal" href="#the-asyncconnectionpool-class">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncConnectionPool</span></code> class</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>