<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="psycopg3 API" href="api/index.html" /><link rel="prev" title="Async operations" href="async.html" />

    <meta name="generator" content="sphinx-3.3.1, furo 2021.02.28.beta28"/>
        <title>Cursor types - psycopg3 UNRELEASED documentation</title>
      <link rel="stylesheet" href="_static/styles/furo.css?digest=be5985a4059b5c2cd56ed0804790452beca62674">
    <link rel="stylesheet" href="_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 1rem;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 1rem;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="_static/psycopg.css" />
    <link rel="stylesheet" href="_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<div class="announcement">
  <aside class="announcement-content">
     <a style="text-decoration: none; color: white;"
   href="https://github.com/sponsors/dvarrazzo/">
   <img height="24px" width="24px" src="/img/logo/psycopg-48.png"/>
    Sponsor psycopg3 on GitHub
</a>
 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">psycopg3 UNRELEASED documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/psycopg.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/psycopg.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">psycopg3 UNRELEASED documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="basic/index.html">Getting started with <code class="docutils literal notranslate"><span class="pre">psycopg3</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html">Basic module usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="params.html">Passing parameters to SQL queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="adapt-types.html">Adaptation between Python and PostgreSQL types</a></li>
<li class="toctree-l2"><a class="reference internal" href="transactions.html">Transaction management</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="advanced/index.html">Advanced topics</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="row-factories.html">Row factories</a></li>
<li class="toctree-l2"><a class="reference internal" href="adaptation.html">Data adaptation configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="prepared.html">Prepared statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="copy.html">Using COPY TO and COPY FROM</a></li>
<li class="toctree-l2"><a class="reference internal" href="async.html">Async operations</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Cursor types</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/index.html"><code class="docutils literal notranslate"><span class="pre">psycopg3</span></code> API</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="connection.html">Connection classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="cursor.html">Cursor classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sql</span></code> – SQL string composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">errors</span></code> – package exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">types</span></code> – types mapping and adaptation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pq.html"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pq</span></code> – libpq wrapper module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="from_pg2.html">Differences from <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code></a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="cursor-types">
<span id="index-0"></span><span id="id1"></span><h1>Cursor types<a class="headerlink" href="#cursor-types" title="Permalink to this headline">¶</a></h1>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> can manage kinds of “cursors” which differ in where the state of a
query being processed is stored: <a class="reference internal" href="#client-side-cursors"><span class="std std-ref">Client-side cursors</span></a> and
<a class="reference internal" href="#server-side-cursors"><span class="std std-ref">Server-side cursors</span></a>.</p>
<div class="section" id="client-side-cursors">
<span id="index-1"></span><span id="id2"></span><h2>Client-side cursors<a class="headerlink" href="#client-side-cursors" title="Permalink to this headline">¶</a></h2>
<p>Client-side cursors are what <code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> uses in its normal querying process.
They are implemented by the <a class="reference internal" href="cursor.html#psycopg3.Cursor" title="psycopg3.Cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Cursor</span></code></a> and <a class="reference internal" href="cursor.html#psycopg3.AsyncCursor" title="psycopg3.AsyncCursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncCursor</span></code></a> classes. In such
querying pattern, after a cursor sends a query to the server (usually calling
<a class="reference internal" href="cursor.html#psycopg3.Cursor.execute" title="psycopg3.Cursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">execute()</span></code></a>), the server replies transferring to the client the whole
set of results requested, which is stored in the state of the same cursor and
from where it can be read from Python code (using methods such as
<a class="reference internal" href="cursor.html#psycopg3.Cursor.fetchone" title="psycopg3.Cursor.fetchone"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fetchone()</span></code></a> and siblings).</p>
<p>This querying process is very scalable because, after a query result has been
transmitted to the client, the server doesn’t keep any state. Because the
results are already in the client memory, iterating its rows is very quick.</p>
<p>The downside of this querying method is that the entire result has to be
transmitted completely to the client (with a time proportional to its size)
and the client needs enough memory to hold it, so it is only suitable for
reasonably small result sets.</p>
</div>
<div class="section" id="server-side-cursors">
<span id="index-2"></span><span id="id3"></span><h2>Server-side cursors<a class="headerlink" href="#server-side-cursors" title="Permalink to this headline">¶</a></h2>
<p>PostgreSQL has also its own concept of <em>cursor</em> (sometimes also called
<em>portal</em>). When a database cursor is created, the query is not necessarily
completely processed: the server might be able to produce results only as they
are needed. Only the results requested are transmitted to the client: if the
query result is very large but the client only needs the first few records it
is possible to transmit only them.</p>
<p>The downside is that the server needs to keep track of the partially
processed results, so it uses more memory and resources on the server.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> allows the use of server-side cursors using the classes
<a class="reference internal" href="cursor.html#psycopg3.ServerCursor" title="psycopg3.ServerCursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ServerCursor</span></code></a> and <a class="reference internal" href="cursor.html#psycopg3.AsyncServerCursor" title="psycopg3.AsyncServerCursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AsyncServerCursor</span></code></a>. They are usually created by passing
the <em>name</em> parameter to the <a class="reference internal" href="connection.html#psycopg3.Connection.cursor" title="psycopg3.Connection.cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor()</span></code></a> method (in <code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg2</span></code> they
are also called <em>named cursors</em>). The use of these classes is similar to their
client-side counterparts: their interface is the same, but behind the scene
they send commands to control the state of the cursor in the server (for
instance when fetching new records or when moving using <a class="reference internal" href="cursor.html#psycopg3.Cursor.scroll" title="psycopg3.Cursor.scroll"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scroll()</span></code></a>).</p>
<p>Using a server-side cursor it is possible to process datasets larger than what
would fit in the client memory. However for small queries they are less
efficient because it takes more commands to receive their result, so you
should use them only if you need to process huge results or if only a partial
result is needed.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Server-side cursors are created and managed by <a class="reference internal" href="cursor.html#psycopg3.ServerCursor" title="psycopg3.ServerCursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ServerCursor</span></code></a> using SQL
commands such as <a class="reference external" href="https://www.postgresql.org/docs/current/sql-declare.html">DECLARE</a>, <a class="reference external" href="https://www.postgresql.org/docs/current/sql-fetch.html">FETCH</a>, <a class="reference external" href="https://www.postgresql.org/docs/current/sql-move.html">MOVE</a>. The PostgreSQL documentation
gives a good idea of what is possible to do with them.</p>
</div>
</div>
<div class="section" id="stealing-an-existing-cursor">
<span id="cursor-steal"></span><h2>“Stealing” an existing cursor<a class="headerlink" href="#stealing-an-existing-cursor" title="Permalink to this headline">¶</a></h2>
<p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg3</span></code> <a class="reference internal" href="cursor.html#psycopg3.ServerCursor" title="psycopg3.ServerCursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ServerCursor</span></code></a> can be also used to consume a cursor that the
<code class="sql docutils literal notranslate"><span class="pre">DECLARE</span></code> generated by its <a class="reference internal" href="cursor.html#psycopg3.ServerCursor.execute" title="psycopg3.ServerCursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">execute()</span></code></a> method can produce.</p>
<p>For instance if you have a PL/pgSQL function creating a cursor:</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">reffunc</span><span class="p">(</span><span class="n">refcursor</span><span class="p">)</span> <span class="k">RETURNS</span> <span class="n">refcursor</span> <span class="k">AS</span> <span class="s">$$</span>
<span class="k">BEGIN</span>
    <span class="k">OPEN</span> <span class="nv">$1</span> <span class="k">FOR</span> <span class="k">SELECT</span> <span class="n">col</span> <span class="k">FROM</span> <span class="n">test</span><span class="p">;</span>
    <span class="k">RETURN</span> <span class="nv">$1</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="s">$$</span> <span class="k">LANGUAGE</span> <span class="n">plpgsql</span><span class="p">;</span>
</pre></div>
</div>
<p>you can run a one-off command (e.g. using <a class="reference internal" href="connection.html#psycopg3.Connection.execute" title="psycopg3.Connection.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>) to call it
and create the server cursor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"select reffunc('curname')"</span><span class="p">)</span>
</pre></div>
</div>
<p>then create a server-side cursor with the same name and call directly the
fetch methods, omitting to call <a class="reference internal" href="cursor.html#psycopg3.ServerCursor.execute" title="psycopg3.ServerCursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">execute()</span></code></a> before:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="s1">'curname'</span><span class="p">)</span>
<span class="c1"># no cur.execute()</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>  <span class="c1"># or cur.fetchone(), cur.fetchmany()...</span>
    <span class="c1"># do something with record</span>
</pre></div>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><code class="docutils literal notranslate"><span class="pre">psycopg3</span></code> API</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="async.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Async operations</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2020-2021, Daniele Varrazzo and The Psycopg Team
            |
            <a class="muted-link" href="_sources/cursors.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Cursor types</a><ul>
<li><a class="reference internal" href="#client-side-cursors">Client-side cursors</a></li>
<li><a class="reference internal" href="#server-side-cursors">Server-side cursors</a></li>
<li><a class="reference internal" href="#stealing-an-existing-cursor">“Stealing” an existing cursor</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>