<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Basic module usage &#8212; Psycopg 2.9.11 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/better.css?v=58ad701a" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=null"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'null');
    </script>
    <script src="_static/documentation_options.js?v=6d47958c"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The psycopg2 module content" href="module.html" />
    <link rel="prev" title="Installation" href="install.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <link rel="stylesheet" href="_static/psycopg.css" type="text/css" />
  </head><body>
    <header id="pageheader"><h1><a href="index.html ">
        Psycopg 2.9.11 documentation
    </a></h1></header>
  <div class="related top">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="install.html" title="Previous document">Installation</a>
        </li>
        <li>
          <a href="module.html" title="Next document">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg2</span></code> module content</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="index.html">Home</a></li> 
    </ul>
  </nav>
  </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="basic-module-usage">
<span id="usage"></span><h1>Basic module usage<a class="headerlink" href="#basic-module-usage" title="Link to this heading">¶</a></h1>
<p id="index-0">The basic Psycopg usage is common to all the database adapters implementing
the <a class="reference external" href="https://www.python.org/dev/peps/pep-0249/">DB API 2.0</a> protocol. Here is an interactive session showing some of the
basic commands:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">psycopg2</span>

<span class="go"># Connect to an existing database</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;dbname=test user=postgres&quot;</span><span class="p">)</span>

<span class="go"># Open a cursor to perform database operations</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="go"># Execute a command: this creates a new table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE test (id serial PRIMARY KEY, num integer, data varchar);&quot;</span><span class="p">)</span>

<span class="go"># Pass data to fill a query placeholders and let Psycopg perform</span>
<span class="go"># the correct conversion (no more SQL injections!)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO test (num, data) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
<span class="gp">... </span>     <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;abc&#39;def&quot;</span><span class="p">))</span>

<span class="go"># Query the database and obtain data as Python objects</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM test;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">(1, 100, &quot;abc&#39;def&quot;)</span>

<span class="go"># Make the changes to the database persistent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="go"># Close communication with the database</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The main entry points of Psycopg are:</p>
<ul class="simple">
<li><p>The function <a class="reference internal" href="module.html#psycopg2.connect" title="psycopg2.connect"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connect()</span></code></a> creates a new database session and
returns a new <a class="reference internal" href="connection.html#connection" title="connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection</span></code></a> instance.</p></li>
<li><p>The class <a class="reference internal" href="connection.html#connection" title="connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection</span></code></a> encapsulates a database session. It allows to:</p>
<ul>
<li><p>create new <a class="reference internal" href="cursor.html#cursor" title="cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor</span></code></a> instances using the <a class="reference internal" href="connection.html#connection.cursor" title="connection.cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor()</span></code></a> method to
execute database commands and queries,</p></li>
<li><p>terminate transactions using the methods <a class="reference internal" href="connection.html#connection.commit" title="connection.commit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">commit()</span></code></a> or
<a class="reference internal" href="connection.html#connection.rollback" title="connection.rollback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rollback()</span></code></a>.</p></li>
</ul>
</li>
<li><p>The class <a class="reference internal" href="cursor.html#cursor" title="cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor</span></code></a> allows interaction with the database:</p>
<ul>
<li><p>send commands to the database using methods such as <a class="reference internal" href="cursor.html#cursor.execute" title="cursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">execute()</span></code></a>
and <a class="reference internal" href="cursor.html#cursor.executemany" title="cursor.executemany"><code class="xref py py-obj docutils literal notranslate"><span class="pre">executemany()</span></code></a>,</p></li>
<li><p>retrieve data from the database <a class="reference internal" href="cursor.html#cursor-iterable"><span class="std std-ref">by iteration</span></a> or
using methods such as <a class="reference internal" href="cursor.html#cursor.fetchone" title="cursor.fetchone"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fetchone()</span></code></a>, <a class="reference internal" href="cursor.html#cursor.fetchmany" title="cursor.fetchmany"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fetchmany()</span></code></a>,
<a class="reference internal" href="cursor.html#cursor.fetchall" title="cursor.fetchall"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fetchall()</span></code></a>.</p></li>
</ul>
</li>
</ul>
<section id="passing-parameters-to-sql-queries">
<span id="query-parameters"></span><span id="index-1"></span><h2>Passing parameters to SQL queries<a class="headerlink" href="#passing-parameters-to-sql-queries" title="Link to this heading">¶</a></h2>
<p>Psycopg converts Python variables to SQL values using their types: the Python
type determines the function used to convert the object into a string
representation suitable for PostgreSQL.  Many standard Python types are
already <a class="reference internal" href="#python-types-adaptation">adapted to the correct SQL representation</a>.</p>
<p>Passing parameters to an SQL statement happens in functions such as
<a class="reference internal" href="cursor.html#cursor.execute" title="cursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor.execute()</span></code></a> by using <code class="docutils literal notranslate"><span class="pre">%s</span></code> placeholders in the SQL statement, and
passing a sequence of values as the second argument of the function. For
example the Python function call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">    INSERT INTO some_table (an_int, a_date, a_string)</span>
<span class="gp">... </span><span class="s2">    VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">);</span>
<span class="gp">... </span><span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span> <span class="s2">&quot;O&#39;Reilly&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>is converted into a SQL command similar to:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">some_table</span><span class="w"> </span><span class="p">(</span><span class="n">an_int</span><span class="p">,</span><span class="w"> </span><span class="n">a_date</span><span class="p">,</span><span class="w"> </span><span class="n">a_string</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2005-11-18&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;O&#39;&#39;Reilly&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Named arguments are supported too using <code class="samp docutils literal notranslate"><span class="pre">%(</span><em><span class="pre">name</span></em><span class="pre">)s</span></code> placeholders in the
query and specifying the values into a mapping.  Using named arguments allows
to specify the values in any order and to repeat the same value in several
places in the query:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">    INSERT INTO some_table (an_int, a_date, another_date, a_string)</span>
<span class="gp">... </span><span class="s2">    VALUES (</span><span class="si">%(int)s</span><span class="s2">, </span><span class="si">%(date)s</span><span class="s2">, </span><span class="si">%(date)s</span><span class="s2">, </span><span class="si">%(str)s</span><span class="s2">);</span>
<span class="gp">... </span><span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s2">&quot;O&#39;Reilly&quot;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">)})</span>
</pre></div>
</div>
<p>Using characters <code class="docutils literal notranslate"><span class="pre">%</span></code>, <code class="docutils literal notranslate"><span class="pre">(</span></code>, <code class="docutils literal notranslate"><span class="pre">)</span></code> in the argument names is not supported.</p>
<p>When parameters are used, in order to include a literal <code class="docutils literal notranslate"><span class="pre">%</span></code> in the query you
can use the <code class="docutils literal notranslate"><span class="pre">%%</span></code> string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT (</span><span class="si">%s</span><span class="s2"> % 2) = 0 AS even&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>       <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT (</span><span class="si">%s</span><span class="s2"> </span><span class="si">%%</span><span class="s2"> 2) = 0 AS even&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>      <span class="c1"># correct</span>
</pre></div>
</div>
<p>While the mechanism resembles regular Python strings manipulation, there are a
few subtle differences you should care about when passing parameters to a
query.</p>
<ul>
<li><p>The Python string operator <code class="docutils literal notranslate"><span class="pre">%</span></code> <em>must not be used</em>: the <a class="reference internal" href="cursor.html#cursor.execute" title="cursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">execute()</span></code></a>
method accepts a tuple or dictionary of values as second parameter.
<a class="reference internal" href="#sql-injection"><strong>Never</strong> use <code class="docutils literal notranslate"><span class="pre">%</span></code> or <code class="docutils literal notranslate"><span class="pre">+</span></code> to merge values
into queries</a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>  <span class="c1"># correct</span>
</pre></div>
</div>
</li>
<li><p>For positional variables binding, <em>the second argument must always be a
sequence</em>, even if it contains a single variable (remember that Python
requires a comma to create a single element tuple):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO foo VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">)</span>    <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO foo VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">))</span>  <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO foo VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,))</span> <span class="c1"># correct</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO foo VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">])</span>  <span class="c1"># correct</span>
</pre></div>
</div>
</li>
<li><p>The placeholder <em>must not be quoted</em>. Psycopg will add quotes where needed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span> <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>   <span class="c1"># correct</span>
</pre></div>
</div>
</li>
<li><p>The variables placeholder <em>must always be a</em> <code class="docutils literal notranslate"><span class="pre">%s</span></code>, even if a different
placeholder (such as a <code class="docutils literal notranslate"><span class="pre">%d</span></code> for integers or <code class="docutils literal notranslate"><span class="pre">%f</span></code> for floats) may look
more appropriate:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>   <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO numbers VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>   <span class="c1"># correct</span>
</pre></div>
</div>
</li>
<li><p>Only query values should be bound via this method: it shouldn’t be used to
merge table or field names to the query (Psycopg will try quoting the table
name as a string value, generating invalid SQL). If you need to generate
dynamically SQL queries (for instance choosing dynamically a table name)
you can use the facilities provided by the <a class="reference internal" href="sql.html#module-psycopg2.sql" title="psycopg2.sql"><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg2.sql</span></code></a> module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO </span><span class="si">%s</span><span class="s2"> VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;numbers&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>  <span class="c1"># WRONG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>                                                <span class="c1"># correct</span>
<span class="gp">... </span>    <span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;INSERT INTO </span><span class="si">{}</span><span class="s2"> VALUES (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;numbers&#39;</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
</pre></div>
</div>
</li>
</ul>
<section id="the-problem-with-the-query-parameters">
<span id="sql-injection"></span><span id="index-2"></span><h3>The problem with the query parameters<a class="headerlink" href="#the-problem-with-the-query-parameters" title="Link to this heading">¶</a></h3>
<p>The SQL representation of many data types is often different from their Python
string representation. The typical example is with single quotes in strings:
in SQL single quotes are used as string literal delimiters, so the ones
appearing inside the string itself must be escaped, whereas in Python single
quotes can be left unescaped if the string is delimited by double quotes.</p>
<p>Because of the difference, sometime subtle, between the data types
representations, a naïve approach to query strings composition, such as using
Python strings concatenation, is a recipe for <em>terrible</em> problems:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">SQL</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO authors (name) VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;);&quot;</span> <span class="c1"># NEVER DO THIS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;O&#39;Reilly&quot;</span><span class="p">,</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">SQL</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span> <span class="c1"># THIS WILL FAIL MISERABLY</span>
<span class="go">ProgrammingError: syntax error at or near &quot;Reilly&quot;</span>
<span class="go">LINE 1: INSERT INTO authors (name) VALUES (&#39;O&#39;Reilly&#39;)</span>
<span class="go">                                              ^</span>
</pre></div>
</div>
<p>If the variables containing the data to send to the database come from an
untrusted source (such as a form published on a web site) an attacker could
easily craft a malformed string, either gaining access to unauthorized data or
performing destructive operations on the database. This form of attack is
called <a class="reference external" href="https://en.wikipedia.org/wiki/SQL_injection">SQL injection</a> and is known to be one of the most widespread forms of
attack to database servers. Before continuing, please print <a class="reference external" href="https://xkcd.com/327/">this page</a> as a
memo and hang it onto your desk.</p>
<p>Psycopg can <a class="reference internal" href="#python-types-adaptation">automatically convert Python objects to and from SQL
literals</a>: using this feature your code will be more robust and
reliable. We must stress this point:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Never, <strong>never</strong>, <strong>NEVER</strong> use Python string concatenation (<code class="docutils literal notranslate"><span class="pre">+</span></code>) or
string parameters interpolation (<code class="docutils literal notranslate"><span class="pre">%</span></code>) to pass variables to a SQL query
string.  Not even at gunpoint.</p>
</div>
<p>The correct way to pass variables in a SQL command is using the second
argument of the <a class="reference internal" href="cursor.html#cursor.execute" title="cursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">execute()</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">SQL</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO authors (name) VALUES (</span><span class="si">%s</span><span class="s2">);&quot;</span> <span class="c1"># Note: no quotes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;O&#39;Reilly&quot;</span><span class="p">,</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">SQL</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="c1"># Note: no % operator</span>
</pre></div>
</div>
</section>
<section id="values-containing-backslashes-and-like">
<h3>Values containing backslashes and LIKE<a class="headerlink" href="#values-containing-backslashes-and-like" title="Link to this heading">¶</a></h3>
<p>Unlike in Python, the backslash (<code class="xref py py-obj docutils literal notranslate"><span class="pre">\</span></code>) is not used as an escape
character <em>except</em> in patterns used with <code class="xref py py-obj docutils literal notranslate"><span class="pre">LIKE</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">ILIKE</span></code> where they
are needed to escape the <code class="xref py py-obj docutils literal notranslate"><span class="pre">%</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">_</span></code> characters.</p>
<p>This can lead to confusing situations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\Bobby.Tables&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;INSERT INTO mytable(path) VALUES (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM mytable WHERE path LIKE </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="go">[]</span>
</pre></div>
</div>
<p>The solution is to specify an <code class="xref py py-obj docutils literal notranslate"><span class="pre">ESCAPE</span></code> character of <code class="xref py py-obj docutils literal notranslate"><span class="pre">''</span></code> (empty string)
in your <code class="xref py py-obj docutils literal notranslate"><span class="pre">LIKE</span></code> query:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM mytable WHERE path LIKE </span><span class="si">%s</span><span class="s2"> ESCAPE &#39;&#39;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="p">,))</span>
</pre></div>
</div>
</section>
</section>
<section id="adaptation-of-python-values-to-sql-types">
<span id="python-types-adaptation"></span><span id="index-3"></span><h2>Adaptation of Python values to SQL types<a class="headerlink" href="#adaptation-of-python-values-to-sql-types" title="Link to this heading">¶</a></h2>
<p>Many standard Python types are adapted into SQL and returned as Python
objects when a query is executed.</p>
<p>The following table shows the default mapping between Python and PostgreSQL
types:</p>
<table class="data-types docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Python</p></th>
<th class="head"><p>PostgreSQL</p></th>
<th class="head"><p>See also</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">NULL</span></code></p></td>
<td rowspan="2"><p><a class="reference internal" href="#adapt-consts"><span class="std std-ref">Constants adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">bool</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">real</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">double</span></code></div>
</div>
</td>
<td rowspan="3"><p><a class="reference internal" href="#adapt-numbers"><span class="std std-ref">Numbers adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></div>
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">long</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">smallint</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">integer</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">bigint</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Decimal" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decimal</span></code></a></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">numeric</span></code></p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></div>
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">unicode</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">varchar</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">text</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="#adapt-string"><span class="std std-ref">Strings adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">buffer</span></code></div>
<div class="line"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#memoryview" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">memoryview</span></code></a></div>
<div class="line"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytearray</span></code></a></div>
<div class="line"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code></a></div>
<div class="line">Buffer protocol</div>
</div>
</td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">bytea</span></code></p></td>
<td><p><a class="reference internal" href="#adapt-binary"><span class="std std-ref">Binary adaptation</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">date</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">date</span></code></p></td>
<td rowspan="4"><p><a class="reference internal" href="#adapt-date"><span class="std std-ref">Date/Time objects adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">time</span></code></p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">time</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">timetz</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime</span></code></p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">timestamp</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">timestamptz</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">timedelta</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">interval</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">ARRAY</span></code></p></td>
<td><p><a class="reference internal" href="#adapt-list"><span class="std std-ref">Lists adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code></div>
<div class="line"><code class="xref py py-obj docutils literal notranslate"><span class="pre">namedtuple</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Composite types</div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">IN</span></code> syntax</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><a class="reference internal" href="#adapt-tuple"><span class="std std-ref">Tuples adaptation</span></a></div>
<div class="line"><a class="reference internal" href="extras.html#adapt-composite"><span class="std std-ref">Composite types casting</span></a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">hstore</span></code></p></td>
<td><p><a class="reference internal" href="extras.html#adapt-hstore"><span class="std std-ref">Hstore data type</span></a></p></td>
</tr>
<tr class="row-even"><td><p>Psycopg’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">Range</span></code></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">range</span></code></p></td>
<td><p><a class="reference internal" href="extras.html#adapt-range"><span class="std std-ref">Range data types</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>Anything™</p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">json</span></code></p></td>
<td><p><a class="reference internal" href="extras.html#adapt-json"><span class="std std-ref">JSON adaptation</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://docs.python.org/3/library/uuid.html#uuid.UUID" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">UUID</span></code></a></p></td>
<td><p><code class="sql docutils literal notranslate"><span class="pre">uuid</span></code></p></td>
<td><p><a class="reference internal" href="extras.html#adapt-uuid"><span class="std std-ref">UUID data type</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://docs.python.org/3/library/ipaddress.html#module-ipaddress" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ipaddress</span></code></a>
objects</p></td>
<td><div class="line-block">
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">inet</span></code></div>
<div class="line"><code class="sql docutils literal notranslate"><span class="pre">cidr</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="extras.html#adapt-network"><span class="std std-ref">Networking data types</span></a></p></td>
</tr>
</tbody>
</table>
<p>The mapping is fairly customizable: see <a class="reference internal" href="advanced.html#adapting-new-types"><span class="std std-ref">Adapting new Python types to SQL syntax</span></a> and
<a class="reference internal" href="advanced.html#type-casting-from-sql-to-python"><span class="std std-ref">Type casting of SQL types into Python objects</span></a>.  You can also find a few other
specialized adapters in the <a class="reference internal" href="extras.html#module-psycopg2.extras" title="psycopg2.extras"><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg2.extras</span></code></a> module.</p>
<section id="constants-adaptation">
<span id="adapt-consts"></span><span id="index-4"></span><h3>Constants adaptation<a class="headerlink" href="#constants-adaptation" title="Link to this heading">¶</a></h3>
<p>Python <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> and boolean values <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a> are converted into the
proper SQL literals:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">mogrify</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="go">&#39;SELECT NULL, true, false;&#39;</span>
</pre></div>
</div>
</section>
<section id="numbers-adaptation">
<span id="adapt-numbers"></span><span id="index-5"></span><h3>Numbers adaptation<a class="headerlink" href="#numbers-adaptation" title="Link to this heading">¶</a></h3>
<p>Python numeric objects <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">long</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Decimal" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decimal</span></code></a> are
converted into a PostgreSQL numerical representation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">mogrify</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="n">L</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;10.00&quot;</span><span class="p">)))</span>
<span class="go">&#39;SELECT 10, 10, 10.0, 10.00;&#39;</span>
</pre></div>
</div>
<p>Reading from the database, integer types are converted into <code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, floating
point types are converted into <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>, <code class="sql docutils literal notranslate"><span class="pre">numeric</span></code>/<code class="sql docutils literal notranslate"><span class="pre">decimal</span></code> are
converted into <code class="xref py py-obj docutils literal notranslate"><span class="pre">Decimal</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sometimes you may prefer to receive <code class="sql docutils literal notranslate"><span class="pre">numeric</span></code> data as <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>
instead, for performance reason or ease of manipulation: you can configure
an adapter to <a class="reference internal" href="faq.html#faq-float"><span class="std std-ref">cast PostgreSQL numeric to Python float</span></a>.
This of course may imply a loss of precision.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/static/datatype-numeric.html">PostgreSQL numeric types</a></p>
</div>
</section>
<section id="strings-adaptation">
<span id="adapt-string"></span><span id="index-6"></span><h3>Strings adaptation<a class="headerlink" href="#strings-adaptation" title="Link to this heading">¶</a></h3>
<p>Python <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">unicode</span></code> are converted into the SQL string syntax.
<code class="xref py py-obj docutils literal notranslate"><span class="pre">unicode</span></code> objects (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code> in Python 3) are encoded in the connection
<a class="reference internal" href="connection.html#connection.encoding" title="connection.encoding"><code class="xref py py-obj docutils literal notranslate"><span class="pre">encoding</span></code></a> before sending to the backend: trying to send a
character not supported by the encoding will result in an error. Data is
usually received as <code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code> (<em>i.e.</em> it is <em>decoded</em> on Python 3, left <em>encoded</em>
on Python 2). However it is possible to receive <code class="xref py py-obj docutils literal notranslate"><span class="pre">unicode</span></code> on Python 2 too:
see <a class="reference internal" href="#unicode-handling"><span class="std std-ref">Unicode handling</span></a>.</p>
<section id="unicode-handling">
<span id="index-7"></span><span id="id6"></span><h4>Unicode handling<a class="headerlink" href="#unicode-handling" title="Link to this heading">¶</a></h4>
<p>Psycopg can exchange Unicode data with a PostgreSQL database.  Python
<code class="xref py py-obj docutils literal notranslate"><span class="pre">unicode</span></code> objects are automatically <em>encoded</em> in the client encoding
defined on the database connection (the <a class="reference external" href="https://www.postgresql.org/docs/current/static/multibyte.html">PostgreSQL encoding</a>, available in
<a class="reference internal" href="connection.html#connection.encoding" title="connection.encoding"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection.encoding</span></code></a>, is translated into a <a class="reference external" href="https://docs.python.org/library/codecs.html">Python encoding</a> using the
<a class="reference internal" href="extensions.html#psycopg2.extensions.encodings" title="psycopg2.extensions.encodings"><code class="xref py py-obj docutils literal notranslate"><span class="pre">encodings</span></code></a> mapping):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
<span class="go">àèìòù€ &lt;type &#39;unicode&#39;&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO test (num, data) VALUES (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">);&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">74</span><span class="p">,</span> <span class="n">u</span><span class="p">))</span>
</pre></div>
</div>
<p>When reading data from the database, in Python 2 the strings returned are
usually 8 bit <code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code> objects encoded in the database client encoding:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
<span class="go">UTF8</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT data FROM test WHERE num = 74&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">àèìòù€ &lt;type &#39;str&#39;&gt; &#39;\xc3\xa0\xc3\xa8\xc3\xac\xc3\xb2\xc3\xb9\xe2\x82\xac&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">set_client_encoding</span><span class="p">(</span><span class="s1">&#39;LATIN9&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT data FROM test WHERE num = 74&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">&lt;type &#39;str&#39;&gt; &#39;\xe0\xe8\xec\xf2\xf9\xa4&#39;</span>
</pre></div>
</div>
<p>In Python 3 instead the strings are automatically <em>decoded</em> in the connection
<a class="reference internal" href="connection.html#connection.encoding" title="connection.encoding"><code class="xref py py-obj docutils literal notranslate"><span class="pre">encoding</span></code></a>, as the <code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code> object can represent Unicode characters.
In Python 2 you must register a <a class="reference internal" href="advanced.html#type-casting-from-sql-to-python"><span class="std std-ref">typecaster</span></a> in order to receive <code class="xref py py-obj docutils literal notranslate"><span class="pre">unicode</span></code> objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">register_type</span><span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT data FROM test WHERE num = 74&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">àèìòù€ &lt;type &#39;unicode&#39;&gt; u&#39;\xe0\xe8\xec\xf2\xf9\u20ac&#39;</span>
</pre></div>
</div>
<p>In the above example, the <a class="reference internal" href="extensions.html#psycopg2.extensions.UNICODE" title="psycopg2.extensions.UNICODE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">UNICODE</span></code></a> typecaster is
registered only on the cursor. It is also possible to register typecasters on
the connection or globally: see the function
<a class="reference internal" href="extensions.html#psycopg2.extensions.register_type" title="psycopg2.extensions.register_type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">register_type()</span></code></a> and
<a class="reference internal" href="advanced.html#type-casting-from-sql-to-python"><span class="std std-ref">Type casting of SQL types into Python objects</span></a> for details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Python 2, if you want to uniformly receive all your database input in
Unicode, you can register the related typecasters globally as soon as
Psycopg is imported:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">psycopg2.extensions</span>
<span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">register_type</span><span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
<span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">register_type</span><span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">UNICODEARRAY</span><span class="p">)</span>
</pre></div>
</div>
<p>and forget about this story.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In some cases, on Python 3, you may want to receive <code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code> instead of
<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>, without undergoing to any decoding. This is especially the case if
the data in the database is in mixed encoding. The
<a class="reference internal" href="extensions.html#psycopg2.extensions.BYTES" title="psycopg2.extensions.BYTES"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BYTES</span></code></a> caster is what you neeed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">psycopg2.extensions</span>
<span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">register_type</span><span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">BYTES</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">register_type</span><span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">BYTESARRAY</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select </span><span class="si">%s</span><span class="s2">::text&quot;</span><span class="p">,</span> <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;€&quot;</span><span class="p">,))</span>
<span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xe2\x82\xac</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="binary-adaptation">
<span id="adapt-binary"></span><span id="index-8"></span><h3>Binary adaptation<a class="headerlink" href="#binary-adaptation" title="Link to this heading">¶</a></h3>
<p>Python types representing binary objects are converted into PostgreSQL binary
string syntax, suitable for <code class="sql docutils literal notranslate"><span class="pre">bytea</span></code> fields.   Such types are <code class="xref py py-obj docutils literal notranslate"><span class="pre">buffer</span></code>
(only available in Python 2), <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#memoryview" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">memoryview</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytearray</span></code></a>, and <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code></a> (only in
Python 3: the name is available in Python 2 but it’s only an alias for the
type <code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>). Any object implementing the <a class="reference external" href="https://www.python.org/dev/peps/pep-3118/">Revised Buffer Protocol</a> should
be usable as binary type. Received data is returned as <code class="xref py py-obj docutils literal notranslate"><span class="pre">buffer</span></code> (in Python 2)
or <code class="xref py py-obj docutils literal notranslate"><span class="pre">memoryview</span></code> (in Python 3).</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.4: </span>only strings were supported before.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.4.1: </span>can parse the ‘hex’ format from 9.0 servers without relying on the
version of the client library.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Python 2, if you have binary data in a <code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code> object, you can pass them
to a <code class="sql docutils literal notranslate"><span class="pre">bytea</span></code> field using the <a class="reference internal" href="module.html#psycopg2.Binary" title="psycopg2.Binary"><code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg2.Binary</span></code></a> wrapper:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mypic</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;picture.png&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into blobs (file) values (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">mypic</span><span class="p">),))</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Since version 9.0 PostgreSQL uses by default <a class="reference external" href="https://www.postgresql.org/docs/current/static/datatype-binary.html">a new “hex” format</a> to
emit <code class="sql docutils literal notranslate"><span class="pre">bytea</span></code> fields. Starting from Psycopg 2.4.1 the format is
correctly supported.  If you use a previous version you will need some
extra care when receiving bytea from PostgreSQL: you must have at least
libpq 9.0 installed on the client or alternatively you can set the
<a class="reference external" href="https://www.postgresql.org/docs/current/static/runtime-config-client.html#GUC-BYTEA-OUTPUT">bytea_output</a> configuration parameter to <code class="docutils literal notranslate"><span class="pre">escape</span></code>, either in the
server configuration file or in the client session (using a query such as
<code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">bytea_output</span> <span class="pre">TO</span> <span class="pre">escape;</span></code>) before receiving binary data.</p>
</div>
</section>
<section id="date-time-objects-adaptation">
<span id="adapt-date"></span><span id="index-9"></span><h3>Date/Time objects adaptation<a class="headerlink" href="#date-time-objects-adaptation" title="Link to this heading">¶</a></h3>
<p>Python builtin <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">date</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.time" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">time</span></code></a>,  <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">timedelta</span></code></a> are converted into PostgreSQL’s
<code class="sql docutils literal notranslate"><span class="pre">timestamp[tz]</span></code>, <code class="sql docutils literal notranslate"><span class="pre">date</span></code>, <code class="sql docutils literal notranslate"><span class="pre">time[tz]</span></code>, <code class="sql docutils literal notranslate"><span class="pre">interval</span></code> data types.
Time zones are supported too.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span>
<span class="go">datetime.datetime(2010, 2, 8, 1, 40, 27, 425337)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">mogrify</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">dt</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
<span class="go">&quot;SELECT &#39;2010-02-08T01:40:27.425337&#39;, &#39;2010-02-08&#39;, &#39;01:40:27.425337&#39;;&quot;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">mogrify</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">dt</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),))</span>
<span class="go">&quot;SELECT &#39;38 days 6027.425337 seconds&#39;;&quot;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/static/datatype-datetime.html">PostgreSQL date/time types</a></p>
</div>
<section id="time-zones-handling">
<span id="tz-handling"></span><span id="index-10"></span><h4>Time zones handling<a class="headerlink" href="#time-zones-handling" title="Link to this heading">¶</a></h4>
<p>The PostgreSQL type <code class="sql docutils literal notranslate"><span class="pre">timestamp</span> <span class="pre">with</span> <span class="pre">time</span> <span class="pre">zone</span></code> (a.k.a.
<code class="sql docutils literal notranslate"><span class="pre">timestamptz</span></code>) is converted into Python <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime</span></code></a> objects.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SET TIME ZONE &#39;Europe/Rome&#39;&quot;</span><span class="p">)</span>  <span class="c1"># UTC + 1 hour</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT &#39;2010-01-01 10:30:45&#39;::timestamptz&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">datetime.datetime(2010, 1, 1, 10, 30, 45,</span>
<span class="go">    tzinfo=datetime.timezone(datetime.timedelta(seconds=3600)))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before Python 3.7, the <a class="reference external" href="https://docs.python.org/3/library/datetime.html#module-datetime" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime</span></code></a> module only supported timezones with an
integer number of minutes. A few historical time zones had seconds in the
UTC offset: these time zones will have the offset rounded to the nearest
minute, with an error of up to 30 seconds, on Python versions before 3.7.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SET TIME ZONE &#39;Asia/Calcutta&#39;&quot;</span><span class="p">)</span>  <span class="c1"># offset was +5:21:10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT &#39;1900-01-01 10:30:45&#39;::timestamptz&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tzinfo</span>
<span class="go"># On Python 3.6: 5h, 21m</span>
<span class="go">datetime.timezone(datetime.timedelta(0, 19260))</span>
<span class="go"># On Python 3.7 and following: 5h, 21m, 10s</span>
<span class="go">datetime.timezone(datetime.timedelta(seconds=19270))</span>
</pre></div>
</div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.2.2: </span>timezones with seconds are supported (with rounding). Previously such
timezones raised an error.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.9: </span>timezones with seconds are supported without rounding.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.9: </span>use <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timezone" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime.timezone</span></code></a> as default tzinfo object instead of
<a class="reference internal" href="tz.html#psycopg2.tz.FixedOffsetTimezone" title="psycopg2.tz.FixedOffsetTimezone"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FixedOffsetTimezone</span></code></a>.</p>
</div>
</section>
<section id="infinite-dates-handling">
<span id="index-11"></span><span id="id12"></span><h4>Infinite dates handling<a class="headerlink" href="#infinite-dates-handling" title="Link to this heading">¶</a></h4>
<p>PostgreSQL can store the representation of an “infinite” date, timestamp, or
interval. Infinite dates are not available to Python, so these objects are
mapped to <code class="xref py py-obj docutils literal notranslate"><span class="pre">date.max</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime.max</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">interval.max</span></code>. Unfortunately the
mapping cannot be bidirectional so these dates will be stored back into the
database with their values, such as <code class="sql docutils literal notranslate"><span class="pre">9999-12-31</span></code>.</p>
<p>It is possible to create an alternative adapter for dates and other objects
to map <code class="xref py py-obj docutils literal notranslate"><span class="pre">date.max</span></code> to <code class="sql docutils literal notranslate"><span class="pre">infinity</span></code>, for instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">InfDateAdapter</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrapped</span> <span class="o">=</span> <span class="n">wrapped</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">getquoted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapped</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&#39;infinity&#39;::date&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapped</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&#39;-infinity&#39;::date&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">DateFromPy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapped</span><span class="p">)</span><span class="o">.</span><span class="n">getquoted</span><span class="p">()</span>

<span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">register_adapter</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">InfDateAdapter</span><span class="p">)</span>
</pre></div>
</div>
<p>Of course it will not be possible to write the value of <code class="xref py py-obj docutils literal notranslate"><span class="pre">date.max</span></code> in the
database anymore: <code class="sql docutils literal notranslate"><span class="pre">infinity</span></code> will be stored instead.</p>
</section>
<section id="time-handling">
<span id="id13"></span><h4>Time handling<a class="headerlink" href="#time-handling" title="Link to this heading">¶</a></h4>
<p>The PostgreSQL <code class="sql docutils literal notranslate"><span class="pre">time</span></code> and Python <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.time" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">time</span></code></a> types are not
fully bidirectional.</p>
<p>Within PostgreSQL, the <code class="sql docutils literal notranslate"><span class="pre">time</span></code> type’s maximum value of <code class="docutils literal notranslate"><span class="pre">24:00:00</span></code> is
treated as 24-hours later than the minimum value of <code class="docutils literal notranslate"><span class="pre">00:00:00</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT &#39;24:00:00&#39;::time - &#39;00:00:00&#39;::time&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">datetime.timedelta(days=1)</span>
</pre></div>
</div>
<p>However, Python’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">time</span></code> only supports times until <code class="docutils literal notranslate"><span class="pre">23:59:59</span></code>.
Retrieving a value of <code class="docutils literal notranslate"><span class="pre">24:00:00</span></code> results in a <code class="xref py py-obj docutils literal notranslate"><span class="pre">time</span></code> of <code class="docutils literal notranslate"><span class="pre">00:00:00</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT &#39;24:00:00&#39;::time, &#39;00:00:00&#39;::time&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">(datetime.time(0, 0), datetime.time(0, 0))</span>
</pre></div>
</div>
</section>
</section>
<section id="lists-adaptation">
<span id="adapt-list"></span><h3>Lists adaptation<a class="headerlink" href="#lists-adaptation" title="Link to this heading">¶</a></h3>
<p id="index-12">Python lists are converted into PostgreSQL <code class="sql docutils literal notranslate"><span class="pre">ARRAY</span></code>s:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">mogrify</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="p">))</span>
<span class="go">&#39;SELECT ARRAY[10,20,30];&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use a Python list as the argument of the <code class="sql docutils literal notranslate"><span class="pre">IN</span></code> operator using
<a class="reference external" href="https://www.postgresql.org/docs/current/static/functions-subquery.html#FUNCTIONS-SUBQUERY-ANY-SOME">the PostgreSQL ANY operator</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM data WHERE id = ANY(</span><span class="si">%s</span><span class="s2">);&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ids</span><span class="p">,))</span>
</pre></div>
</div>
<p>Furthermore <code class="sql docutils literal notranslate"><span class="pre">ANY</span></code> can also work with empty lists, whereas <code class="sql docutils literal notranslate"><span class="pre">IN</span> <span class="pre">()</span></code>
is a SQL syntax error.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reading back from PostgreSQL, arrays are converted to lists of Python
objects as expected, but only if the items are of a known type.
Arrays of unknown types are returned as represented by the database (e.g.
<code class="docutils literal notranslate"><span class="pre">{a,b,c}</span></code>). If you want to convert the items into Python objects you can
easily create a typecaster for <a class="reference internal" href="extensions.html#cast-array-unknown"><span class="std std-ref">array of unknown types</span></a>.</p>
</div>
</section>
<section id="tuples-adaptation">
<span id="adapt-tuple"></span><h3>Tuples adaptation<a class="headerlink" href="#tuples-adaptation" title="Link to this heading">¶</a></h3>
<p id="index-13">Python tuples are converted into a syntax suitable for the SQL <code class="sql docutils literal notranslate"><span class="pre">IN</span></code>
operator and to represent a composite type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cur</span><span class="o">.</span><span class="n">mogrify</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2"> IN </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)))</span>
<span class="go">&#39;SELECT 10 IN (10, 20, 30);&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SQL doesn’t allow an empty list in the <code class="sql docutils literal notranslate"><span class="pre">IN</span></code> operator, so your code
should guard against empty tuples. Alternatively you can <a class="reference internal" href="#adapt-list"><span class="std std-ref">use a
Python list</span></a>.</p>
</div>
<p>If you want PostgreSQL composite types to be converted into a Python
tuple/namedtuple you can use the <a class="reference internal" href="extras.html#psycopg2.extras.register_composite" title="psycopg2.extras.register_composite"><code class="xref py py-obj docutils literal notranslate"><span class="pre">register_composite()</span></code></a>
function.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 2.0.6: </span>the tuple <code class="sql docutils literal notranslate"><span class="pre">IN</span></code> adaptation.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0.14: </span>the tuple <code class="sql docutils literal notranslate"><span class="pre">IN</span></code> adapter is always active.  In previous releases it
was necessary to import the <a class="reference internal" href="extensions.html#module-psycopg2.extensions" title="psycopg2.extensions"><code class="xref py py-obj docutils literal notranslate"><span class="pre">extensions</span></code></a> module to have it
registered.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.3: </span><a class="reference external" href="https://docs.python.org/3/library/collections.html#collections.namedtuple" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">namedtuple</span></code></a> instances are adapted like regular tuples and
can thus be used to represent composite types.</p>
</div>
</section>
</section>
<section id="transactions-control">
<span id="index-14"></span><span id="id15"></span><h2>Transactions control<a class="headerlink" href="#transactions-control" title="Link to this heading">¶</a></h2>
<p>In Psycopg transactions are handled by the <a class="reference internal" href="connection.html#connection" title="connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection</span></code></a> class. By
default, the first time a command is sent to the database (using one of the
<a class="reference internal" href="cursor.html#cursor" title="cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor</span></code></a>s created by the connection), a new transaction is created.
The following database commands will be executed in the context of the same
transaction – not only the commands issued by the first cursor, but the ones
issued by all the cursors created by the same connection.  Should any command
fail, the transaction will be aborted and no further command will be executed
until a call to the <a class="reference internal" href="connection.html#connection.rollback" title="connection.rollback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rollback()</span></code></a> method.</p>
<p>The connection is responsible for terminating its transaction, calling either
the <a class="reference internal" href="connection.html#connection.commit" title="connection.commit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">commit()</span></code></a> or <a class="reference internal" href="connection.html#connection.rollback" title="connection.rollback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rollback()</span></code></a> method.  Committed
changes are immediately made persistent in the database.  If the connection
is closed (using the <a class="reference internal" href="connection.html#connection.close" title="connection.close"><code class="xref py py-obj docutils literal notranslate"><span class="pre">close()</span></code></a> method) or destroyed (using <code class="xref py py-obj docutils literal notranslate"><span class="pre">del</span></code>
or by letting it fall out of scope) while a transaction is in progress, the
server will discard the transaction.  However doing so is not advisable:
middleware such as <a class="reference external" href="http://www.pgbouncer.org/">PgBouncer</a> may see the connection closed uncleanly and
dispose of it.</p>
<p>It is possible to set the connection in <em>autocommit</em> mode: this way all the
commands executed will be immediately committed and no rollback is possible. A
few commands (e.g. <code class="sql docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">DATABASE</span></code>, <code class="sql docutils literal notranslate"><span class="pre">VACUUM</span></code>, <code class="sql docutils literal notranslate"><span class="pre">CALL</span></code> on
<a class="reference external" href="https://www.postgresql.org/docs/current/xproc.html">stored procedures</a> using transaction control…) require to be run
outside any transaction: in order to be able to run these commands from
Psycopg, the connection must be in autocommit mode: you can use the
<a class="reference internal" href="connection.html#connection.autocommit" title="connection.autocommit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">autocommit</span></code></a> property.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>By default even a simple <code class="sql docutils literal notranslate"><span class="pre">SELECT</span></code> will start a transaction: in
long-running programs, if no further action is taken, the session will
remain “idle in transaction”, an undesirable condition for several
reasons (locks are held by the session, tables bloat…). For long lived
scripts, either make sure to terminate a transaction as soon as possible or
use an autocommit connection.</p>
</div>
<p>A few other transaction properties can be set session-wide by the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">connection</span></code>: for instance it is possible to have read-only transactions or
change the isolation level. See the <a class="reference internal" href="connection.html#connection.set_session" title="connection.set_session"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_session()</span></code></a> method for all
the details.</p>
<section id="with-statement">
<span id="with"></span><span id="index-15"></span><h3><code class="docutils literal notranslate"><span class="pre">with</span></code> statement<a class="headerlink" href="#with-statement" title="Link to this heading">¶</a></h3>
<p>Starting from version 2.5, psycopg2’s connections and cursors are <em>context
managers</em> and can be used with the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DSN</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">curs</span><span class="p">:</span>
        <span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">SQL</span><span class="p">)</span>
</pre></div>
</div>
<p>When a connection exits the <code class="docutils literal notranslate"><span class="pre">with</span></code> block, if no exception has been raised by
the block, the transaction is committed. In case of exception the transaction
is rolled back.</p>
<p>When a cursor exits the <code class="docutils literal notranslate"><span class="pre">with</span></code> block it is closed, releasing any resource
eventually associated with it. The state of the transaction is not affected.</p>
<p>A connection can be used in more than one <code class="docutils literal notranslate"><span class="pre">with</span></code> statement
and each <code class="docutils literal notranslate"><span class="pre">with</span></code> block is effectively wrapped in a separate transaction:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DSN</span><span class="p">)</span>

<span class="k">with</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">curs</span><span class="p">:</span>
        <span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">SQL1</span><span class="p">)</span>

<span class="k">with</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">curs</span><span class="p">:</span>
        <span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">SQL2</span><span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Unlike file objects or other resources, exiting the connection’s
<code class="docutils literal notranslate"><span class="pre">with</span></code> block <strong>doesn’t close the connection</strong>, but only the transaction
associated to it. If you want to make sure the connection is closed after
a certain point, you should still use a try-catch block:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DSN</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># connection usage</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.9: </span><code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">connection</span></code> starts a transaction also on autocommit connections.</p>
</div>
</section>
</section>
<section id="server-side-cursors">
<span id="index-16"></span><span id="id17"></span><h2>Server side cursors<a class="headerlink" href="#server-side-cursors" title="Link to this heading">¶</a></h2>
<p>When a database query is executed, the Psycopg <a class="reference internal" href="cursor.html#cursor" title="cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor</span></code></a> usually fetches
all the records returned by the backend, transferring them to the client
process. If the query returns a huge amount of data, a proportionally large
amount of memory will be allocated by the client.</p>
<p>If the dataset is too large to be practically handled on the client side, it is
possible to create a <em>server side</em> cursor. Using this kind of cursor it is
possible to transfer to the client only a controlled amount of data, so that a
large dataset can be examined without keeping it entirely in memory.</p>
<p>Server side cursor are created in PostgreSQL using the <a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-declare.html"><code class="sql docutils literal notranslate"><span class="pre">DECLARE</span></code></a> command and
subsequently handled using <code class="sql docutils literal notranslate"><span class="pre">MOVE</span></code>, <code class="sql docutils literal notranslate"><span class="pre">FETCH</span></code> and <code class="sql docutils literal notranslate"><span class="pre">CLOSE</span></code> commands.</p>
<p>Psycopg wraps the database server side cursor in <em>named cursors</em>. A named
cursor is created using the <a class="reference internal" href="connection.html#connection.cursor" title="connection.cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor()</span></code></a> method specifying the
<em>name</em> parameter. Such cursor will behave mostly like a regular cursor,
allowing the user to move in the dataset using the <a class="reference internal" href="cursor.html#cursor.scroll" title="cursor.scroll"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scroll()</span></code></a>
method and to read the data using <a class="reference internal" href="cursor.html#cursor.fetchone" title="cursor.fetchone"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fetchone()</span></code></a> and
<a class="reference internal" href="cursor.html#cursor.fetchmany" title="cursor.fetchmany"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fetchmany()</span></code></a> methods. Normally you can only scroll forward in a
cursor: if you need to scroll backwards you should declare your cursor
<a class="reference internal" href="cursor.html#cursor.scrollable" title="cursor.scrollable"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scrollable</span></code></a>.</p>
<p>Named cursors are also <a class="reference internal" href="cursor.html#cursor-iterable"><span class="std std-ref">iterable</span></a> like regular cursors.
Note however that before Psycopg 2.4 iteration was performed fetching one
record at time from the backend, resulting in a large overhead. The attribute
<a class="reference internal" href="cursor.html#cursor.itersize" title="cursor.itersize"><code class="xref py py-obj docutils literal notranslate"><span class="pre">itersize</span></code></a> now controls how many records are fetched at time
during the iteration: the default value of 2000 allows to fetch about 100KB
per roundtrip assuming records of 10-20 columns of mixed number and strings;
you may decrease this value if you are dealing with huge records.</p>
<p>Named cursors are usually created <code class="sql docutils literal notranslate"><span class="pre">WITHOUT</span> <span class="pre">HOLD</span></code>, meaning they live only
as long as the current transaction. Trying to fetch from a named cursor after
a <a class="reference internal" href="connection.html#connection.commit" title="connection.commit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">commit()</span></code></a> or to create a named cursor when the connection
is in <a class="reference internal" href="connection.html#connection.autocommit" title="connection.autocommit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">autocommit</span></code></a> mode will result in an exception.
It is possible to create a <code class="sql docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">HOLD</span></code> cursor by specifying a <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code>
value for the <code class="xref py py-obj docutils literal notranslate"><span class="pre">withhold</span></code> parameter to <a class="reference internal" href="connection.html#connection.cursor" title="connection.cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor()</span></code></a> or by setting the
<a class="reference internal" href="cursor.html#cursor.withhold" title="cursor.withhold"><code class="xref py py-obj docutils literal notranslate"><span class="pre">withhold</span></code></a> attribute to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code> before calling <a class="reference internal" href="cursor.html#cursor.execute" title="cursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">execute()</span></code></a> on
the cursor. It is extremely important to always <a class="reference internal" href="cursor.html#cursor.close" title="cursor.close"><code class="xref py py-obj docutils literal notranslate"><span class="pre">close()</span></code></a> such cursors,
otherwise they will continue to hold server-side resources until the connection
will be eventually closed. Also note that while <code class="sql docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">HOLD</span></code> cursors
lifetime extends well after <a class="reference internal" href="connection.html#connection.commit" title="connection.commit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">commit()</span></code></a>, calling
<a class="reference internal" href="connection.html#connection.rollback" title="connection.rollback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rollback()</span></code></a> will automatically close the cursor.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is also possible to use a named cursor to consume a cursor created
in some other way than using the <code class="sql docutils literal notranslate"><span class="pre">DECLARE</span></code> executed by
<a class="reference internal" href="cursor.html#cursor.execute" title="cursor.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">execute()</span></code></a>. For example, you may have a PL/pgSQL function
returning a cursor:</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">reffunc</span><span class="p">(</span><span class="n">refcursor</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="n">refcursor</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">$$</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="k">OPEN</span><span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test</span><span class="p">;</span>
<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="nv">$1</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="s">$$</span><span class="w"> </span><span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="p">;</span>
</pre></div>
</div>
<p>You can read the cursor content by calling the function with a regular,
non-named, Psycopg cursor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cur1</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cur1</span><span class="o">.</span><span class="n">callproc</span><span class="p">(</span><span class="s1">&#39;reffunc&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;curname&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>and then use a named cursor in the same transaction to “steal the cursor”:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cur2</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="s1">&#39;curname&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">cur2</span><span class="p">:</span>     <span class="c1"># or cur2.fetchone, fetchmany...</span>
    <span class="c1"># do something with record</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</section>
<section id="thread-and-process-safety">
<span id="thread-safety"></span><span id="index-17"></span><h2>Thread and process safety<a class="headerlink" href="#thread-and-process-safety" title="Link to this heading">¶</a></h2>
<p>The Psycopg module and the <a class="reference internal" href="connection.html#connection" title="connection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection</span></code></a> objects are <em>thread-safe</em>: many
threads can access the same database either using separate sessions and
creating a <code class="xref py py-obj docutils literal notranslate"><span class="pre">connection</span></code> per thread or using the same
connection and creating separate <a class="reference internal" href="cursor.html#cursor" title="cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor</span></code></a>s. In <a class="reference external" href="https://www.python.org/dev/peps/pep-0249/">DB API 2.0</a> parlance, Psycopg is
<em>level 2 thread safe</em>.</p>
<p>The difference between the above two approaches is that, using different
connections, the commands will be executed in different sessions and will be
served by different server processes. On the other hand, using many cursors on
the same connection, all the commands will be executed in the same session
(and in the same transaction if the connection is not in <a class="reference internal" href="#transactions-control"><span class="std std-ref">autocommit</span></a> mode), but they will be serialized.</p>
<p>The above observations are only valid for regular threads: they don’t apply to
forked processes nor to green threads. <code class="xref py py-obj docutils literal notranslate"><span class="pre">libpq</span></code> connections <a class="reference external" href="https://www.postgresql.org/docs/current/static/libpq-connect.html#LIBPQ-CONNECT">shouldn’t be used by a
forked processes</a>, so when using a module such as <a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#module-multiprocessing" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">multiprocessing</span></code></a> or a
forking web deploy method such as FastCGI make sure to create the connections
<em>after</em> the fork.</p>
<p>Connections shouldn’t be shared either by different green threads: see
<a class="reference internal" href="advanced.html#green-support"><span class="std std-ref">Support for coroutine libraries</span></a> for further details.</p>
</section>
<section id="using-copy-to-and-copy-from">
<span id="copy"></span><span id="index-18"></span><h2>Using COPY TO and COPY FROM<a class="headerlink" href="#using-copy-to-and-copy-from" title="Link to this heading">¶</a></h2>
<p>Psycopg <a class="reference internal" href="cursor.html#cursor" title="cursor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cursor</span></code></a> objects provide an interface to the efficient
PostgreSQL <a class="reference internal" href="#copy"><code class="sql docutils literal notranslate"><span class="pre">COPY</span></code></a> command to move data from files to tables and back.</p>
<p>Currently no adaptation is provided between Python and PostgreSQL types on
<code class="sql docutils literal notranslate"><span class="pre">COPY</span></code>: the file can be any Python file-like object but its format must be in
the format accepted by <a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-copy.html">PostgreSQL COPY command</a> (data format, escaped
characters, etc).</p>
<p>The methods exposed are:</p>
<dl class="simple">
<dt><a class="reference internal" href="cursor.html#cursor.copy_from" title="cursor.copy_from"><code class="xref py py-obj docutils literal notranslate"><span class="pre">copy_from()</span></code></a></dt><dd><p>Reads data <em>from</em> a file-like object appending them to a database table
(<code class="sql docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">table</span> <span class="pre">FROM</span> <span class="pre">file</span></code> syntax). The source file must provide both
<code class="xref py py-obj docutils literal notranslate"><span class="pre">read()</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">readline()</span></code> method.</p>
</dd>
<dt><a class="reference internal" href="cursor.html#cursor.copy_to" title="cursor.copy_to"><code class="xref py py-obj docutils literal notranslate"><span class="pre">copy_to()</span></code></a></dt><dd><p>Writes the content of a table <em>to</em> a file-like object (<code class="sql docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">table</span> <span class="pre">TO</span>
<span class="pre">file</span></code> syntax). The target file must have a <code class="xref py py-obj docutils literal notranslate"><span class="pre">write()</span></code> method.</p>
</dd>
<dt><a class="reference internal" href="cursor.html#cursor.copy_expert" title="cursor.copy_expert"><code class="xref py py-obj docutils literal notranslate"><span class="pre">copy_expert()</span></code></a></dt><dd><p>Allows to handle more specific cases and to use all the <code class="sql docutils literal notranslate"><span class="pre">COPY</span></code>
features available in PostgreSQL.</p>
</dd>
</dl>
<p>Please refer to the documentation of the single methods for details and
examples.</p>
</section>
<section id="access-to-postgresql-large-objects">
<span id="large-objects"></span><span id="index-19"></span><h2>Access to PostgreSQL large objects<a class="headerlink" href="#access-to-postgresql-large-objects" title="Link to this heading">¶</a></h2>
<p>PostgreSQL offers support for <a class="reference external" href="https://www.postgresql.org/docs/current/static/largeobjects.html">large objects</a>, which provide stream-style
access to user data that is stored in a special large-object structure. They
are useful with data values too large to be manipulated conveniently as a
whole.</p>
<p>Psycopg allows access to the large object using the
<a class="reference internal" href="extensions.html#psycopg2.extensions.lobject" title="psycopg2.extensions.lobject"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lobject</span></code></a> class. Objects are generated using the
<a class="reference internal" href="connection.html#connection.lobject" title="connection.lobject"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection.lobject()</span></code></a> factory method. Data can be retrieved either as bytes
or as Unicode strings.</p>
<p>Psycopg large object support efficient import/export with file system files
using the <a class="reference external" href="https://www.postgresql.org/docs/current/static/lo-interfaces.html#LO-IMPORT"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lo_import()</span></code></a> and <a class="reference external" href="https://www.postgresql.org/docs/current/static/lo-interfaces.html#LO-EXPORT"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lo_export()</span></code></a> libpq functions.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.6: </span>added support for large objects greater than 2GB. Note that the support is
enabled only if all the following conditions are verified:</p>
<ul class="simple">
<li><p>the Python build is 64 bits;</p></li>
<li><p>the extension was built against at least libpq 9.3;</p></li>
<li><p>the server version is at least PostgreSQL 9.3
(<a class="reference internal" href="connection.html#connection.server_version" title="connection.server_version"><code class="xref py py-obj docutils literal notranslate"><span class="pre">server_version</span></code></a> must be &gt;= <code class="docutils literal notranslate"><span class="pre">90300</span></code>).</p></li>
</ul>
<p>If Psycopg was built with 64 bits large objects support (i.e. the first
two conditions above are verified), the <code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg2.__version__</span></code> constant
will contain the <code class="docutils literal notranslate"><span class="pre">lo64</span></code> flag.  If any of the condition is not met
several <code class="xref py py-obj docutils literal notranslate"><span class="pre">lobject</span></code> methods will fail if the arguments exceed 2GB.</p>
</div>
</section>
<section id="two-phase-commit-protocol-support">
<span id="tpc"></span><span id="index-20"></span><h2>Two-Phase Commit protocol support<a class="headerlink" href="#two-phase-commit-protocol-support" title="Link to this heading">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 2.3.</span></p>
</div>
<p>Psycopg exposes the two-phase commit features available since PostgreSQL 8.1
implementing the <em>two-phase commit extensions</em> proposed by the DB API 2.0.</p>
<p>The DB API 2.0 model of two-phase commit is inspired by the <a class="reference external" href="https://publications.opengroup.org/c193">XA specification</a>,
according to which transaction IDs are formed from three components:</p>
<ul class="simple">
<li><p>a format ID (non-negative 32 bit integer)</p></li>
<li><p>a global transaction ID (string not longer than 64 bytes)</p></li>
<li><p>a branch qualifier (string not longer than 64 bytes)</p></li>
</ul>
<p>For a particular global transaction, the first two components will be the same
for all the resources. Every resource will be assigned a different branch
qualifier.</p>
<p>According to the DB API 2.0 specification, a transaction ID is created using the
<a class="reference internal" href="connection.html#connection.xid" title="connection.xid"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection.xid()</span></code></a> method. Once you have a transaction id, a distributed
transaction can be started with <a class="reference internal" href="connection.html#connection.tpc_begin" title="connection.tpc_begin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">connection.tpc_begin()</span></code></a>, prepared using
<a class="reference internal" href="connection.html#connection.tpc_prepare" title="connection.tpc_prepare"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tpc_prepare()</span></code></a> and completed using <a class="reference internal" href="connection.html#connection.tpc_commit" title="connection.tpc_commit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tpc_commit()</span></code></a> or
<a class="reference internal" href="connection.html#connection.tpc_rollback" title="connection.tpc_rollback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tpc_rollback()</span></code></a>.  Transaction IDs can also be retrieved from the
database using <a class="reference internal" href="connection.html#connection.tpc_recover" title="connection.tpc_recover"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tpc_recover()</span></code></a> and completed using the above
<code class="xref py py-obj docutils literal notranslate"><span class="pre">tpc_commit()</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">tpc_rollback()</span></code>.</p>
<p>PostgreSQL doesn’t follow the XA standard though, and the ID for a PostgreSQL
prepared transaction can be any string up to 200 characters long.
Psycopg’s <a class="reference internal" href="extensions.html#psycopg2.extensions.Xid" title="psycopg2.extensions.Xid"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Xid</span></code></a> objects can represent both XA-style
transactions IDs (such as the ones created by the <code class="xref py py-obj docutils literal notranslate"><span class="pre">xid()</span></code> method) and
PostgreSQL transaction IDs identified by an unparsed string.</p>
<p>The format in which the Xids are converted into strings passed to the
database is the same employed by the <a class="reference external" href="https://jdbc.postgresql.org/">PostgreSQL JDBC driver</a>: this should
allow interoperation between tools written in Python and in Java. For example
a recovery tool written in Python would be able to recognize the components of
transactions produced by a Java program.</p>
<p>For further details see the documentation for the above methods.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Basic module usage</a><ul>
<li><a class="reference internal" href="#passing-parameters-to-sql-queries">Passing parameters to SQL queries</a><ul>
<li><a class="reference internal" href="#the-problem-with-the-query-parameters">The problem with the query parameters</a></li>
<li><a class="reference internal" href="#values-containing-backslashes-and-like">Values containing backslashes and LIKE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adaptation-of-python-values-to-sql-types">Adaptation of Python values to SQL types</a><ul>
<li><a class="reference internal" href="#constants-adaptation">Constants adaptation</a></li>
<li><a class="reference internal" href="#numbers-adaptation">Numbers adaptation</a></li>
<li><a class="reference internal" href="#strings-adaptation">Strings adaptation</a><ul>
<li><a class="reference internal" href="#unicode-handling">Unicode handling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#binary-adaptation">Binary adaptation</a></li>
<li><a class="reference internal" href="#date-time-objects-adaptation">Date/Time objects adaptation</a><ul>
<li><a class="reference internal" href="#time-zones-handling">Time zones handling</a></li>
<li><a class="reference internal" href="#infinite-dates-handling">Infinite dates handling</a></li>
<li><a class="reference internal" href="#time-handling">Time handling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lists-adaptation">Lists adaptation</a></li>
<li><a class="reference internal" href="#tuples-adaptation">Tuples adaptation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transactions-control">Transactions control</a><ul>
<li><a class="reference internal" href="#with-statement"><code class="docutils literal notranslate"><span class="pre">with</span></code> statement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#server-side-cursors">Server side cursors</a></li>
<li><a class="reference internal" href="#thread-and-process-safety">Thread and process safety</a></li>
<li><a class="reference internal" href="#using-copy-to-and-copy-from">Using COPY TO and COPY FROM</a></li>
<li><a class="reference internal" href="#access-to-postgresql-large-objects">Access to PostgreSQL large objects</a></li>
<li><a class="reference internal" href="#two-phase-commit-protocol-support">Two-Phase Commit protocol support</a></li>
</ul>
</li>
</ul>

  </div>
<h3>Quick search</h3>
<form class="search" action="search.html" method="get">
  <input type="text" name="q"
   placeholder="type to search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="install.html" title="Previous document">Installation</a>
        </li>
        <li>
          <a href="module.html" title="Next document">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">psycopg2</span></code> module content</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="index.html">Home</a></li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; 2001-2021, Federico Di Gregorio, Daniele Varrazzo, The Psycopg Team.

  </footer>

  
  </body>
</html>